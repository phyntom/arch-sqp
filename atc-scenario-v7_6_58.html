<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scenario Quick Preview - ATC Simulator v7</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400..700&display=swap');
        
        /* Charcoal Color Palette */
        :root {
            --charcoal-darkest: #0f1419;
            --charcoal-darker: #1a1f28;
            --charcoal-dark: #242b36;
            --charcoal-base: #2d3544;
            --charcoal-medium: #394150;
            --charcoal-light: #4a5568;
            --charcoal-lighter: #5a6170;
            --charcoal-lightest: #6d7482;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--charcoal-darkest);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            font-size: 11px;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(30, 37, 48, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(57, 65, 80, 0.6);
            box-shadow: none;
            position: relative;
            z-index: 2500;
        }


        .logo {
            display: flex;
            align-items: center;
            gap: 0;
            margin-left: 36px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.2px;
        }

        .close-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.4);
            color: #ef4444;
        }

        .close-btn svg {
            width: 20px;
            height: 20px;
        }

        .toggle-panel-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .toggle-panel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .toggle-panel-btn svg {
            width: 18px;
            height: 18px;
        }

        .header-close-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            margin-right: -10px;
        }

        .header-close-btn:hover {
            background: rgba(220, 38, 38, 0.2);
            border-color: rgba(220, 38, 38, 0.5);
            color: #ef4444;
        }

        .header-close-btn svg {
            width: 18px;
            height: 18px;
        }



        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 8px 20px -4px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            box-shadow: 0 12px 28px -4px rgba(37, 99, 235, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(45, 53, 68, 0.6);
            color: #ffffff;
            border: 1px solid rgba(57, 65, 80, 0.8);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(57, 65, 80, 0.8);
            border-color: rgba(74, 85, 104, 0.9);
            transform: translateY(-1px);
        }

        /* Secondary Toolbar (under header) */
        .secondary-toolbar {
            background: rgb(30, 37, 48);
            padding: 0 24px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            gap: 12px;
            border-bottom: none;
            height: 46px;
            overflow: visible;
            position: relative;
            z-index: 99;
        }

        .toolbar-weather {
            position: absolute;
            left: 50%;
            margin-left: 340px;
            top: 0;
            height: 46px;
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
        }

        .toolbar-scenario {
            position: absolute;
            left: 24px;
            top: 0;
            height: 46px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.9);
        }

        .toolbar-scenario-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(59, 130, 246, 0.15);
            border-radius: 6px;
            color: #3b82f6;
        }

        .toolbar-scenario-icon svg {
            width: 16px;
            height: 16px;
        }

        .toolbar-scenario-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .toolbar-scenario-name {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
        }

        .toolbar-scenario-airport {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }

        .toolbar-weather-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toolbar-weather-label {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
        }

        .toolbar-weather-value {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .playback-container {
            background: linear-gradient(180deg, 
                rgba(70, 85, 105, 0.95) 0%, 
                rgba(45, 55, 70, 0.9) 8%,
                rgb(30, 37, 48) 25%, 
                rgb(30, 37, 48) 100%);
            border: none;
            border-radius: 0 0 16px 16px;
            padding: 14px 24px;
            padding-top: 20px;
            box-shadow: 
                4px 4px 20px rgba(0, 0, 0, 0.3),
                -4px 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.15),
                inset 0 -2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 100;
            margin-top: -8px;
        }

        .playback-container::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 0;
            right: 0;
            height: 28px;
            background: rgb(30, 37, 48);
            z-index: -1;
        }

        .playback-container::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 5%;
            right: 5%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 2px;
        }

        .main-container {
            display: flex;
            flex: 1;
            padding: 0;
            gap: 0;
            background: var(--charcoal-darkest);
            position: relative;
        }

        .main-container.fullscreen {
            padding: 0;
            gap: 0;
        }

        /* Vertical Toolbar */
        .vertical-toolbar {
            width: 52px;
            min-width: 52px;
            background: rgb(24, 30, 40);
            border-right: 1px solid rgba(57, 65, 80, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 12px 0;
            z-index: 101;
        }

        .toolbar-icons-top,
        .toolbar-icons-bottom {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .toolbar-icons-bottom {
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .toolbar-icon-btn {
            width: 38px;
            height: 38px;
            margin: 2px 5px;
            padding: 0;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.35);
            position: relative;
        }

        .toolbar-icon-btn:hover {
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.7);
            transform: scale(1.05);
        }

        .toolbar-icon-btn.active {
            background: linear-gradient(180deg, 
                rgba(120, 130, 145, 0.4) 0%, 
                rgba(90, 97, 112, 0.35) 15%,
                rgba(70, 77, 92, 0.3) 100%);
            color: rgba(220, 225, 235, 0.95);
            box-shadow: 
                inset 0 1px 1px rgba(255, 255, 255, 0.15),
                inset 0 -1px 2px rgba(0, 0, 0, 0.1),
                0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .toolbar-icon-btn svg {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            transition: transform 0.2s;
        }

        .toolbar-icon-btn:hover svg {
            transform: scale(1.08);
        }

        .tool-pane {
            width: 290px;
            min-width: 290px;
            background: rgba(30, 38, 50, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 0;
            border: none;
            border-right: 1px solid rgba(57, 65, 80, 0.4);
            box-shadow: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: absolute;
            left: 52px;
            top: 0;
            bottom: 0;
            z-index: 100;
        }

        .tool-pane.hidden {
            transform: translateX(-264px);
        }

        /* Collapse Handle - VS Code style */
        .panel-collapse-handle {
            position: absolute;
            left: 342px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 64px;
            background: rgba(40, 50, 65, 0.98);
            border: 1px solid rgba(80, 95, 115, 0.8);
            border-left: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 102;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
        }

        .panel-collapse-handle:hover {
            background: rgba(55, 70, 90, 0.98);
            border-color: rgba(100, 120, 145, 0.9);
            width: 20px;
        }

        .panel-collapse-handle svg {
            width: 10px;
            height: 10px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.2s;
        }

        .panel-collapse-handle:hover svg {
            color: rgba(255, 255, 255, 1);
        }

        .tool-pane.hidden ~ .panel-collapse-handle {
            left: 52px;
            border-right: 1px solid rgba(80, 95, 115, 0.8);
            border-left: none;
            border-radius: 0 8px 8px 0;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
        }

        .tool-pane.hidden ~ .panel-collapse-handle:hover {
            left: 52px;
            width: 20px;
        }

        .tool-pane.hidden ~ .panel-collapse-handle svg {
            transform: rotate(180deg);
        }

        /* When left section is hidden, move collapse handle to edge */
        .main-container.hide-left-section .panel-collapse-handle {
            left: 0;
        }

        .main-container.hide-left-section .panel-collapse-handle svg {
            transform: rotate(180deg);
        }

        /* Hide left section using transform (like right panel) - doesn't affect canvas */
        .vertical-toolbar {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tool-pane {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* When hidden, slide both toolbar and panel to the left */
        .main-container.hide-left-section .vertical-toolbar {
            transform: translateX(-52px);
        }

        .main-container.hide-left-section .tool-pane {
            transform: translateX(-342px);
        }

        .tool-pane-header {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(57, 65, 80, 0.5);
            background: rgba(15, 20, 25, 0.4);
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .tool-pane-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 12px 0 12px;
            border-bottom: 1px solid rgba(57, 65, 80, 0.4);
            background: rgba(20, 25, 32, 0.5);
        }

        .tool-tab {
            flex: 1;
            padding: 12px 12px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.5px;
        }

        .tool-tab:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(70, 80, 95, 0.2);
        }

        .tool-tab.active {
            color: rgba(200, 210, 220, 0.95);
            border-bottom-color: rgba(140, 150, 165, 0.8);
            background: rgba(70, 80, 95, 0.25);
        }

        .tool-pane-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .tool-pane-view {
            display: none;
        }

        .tool-pane-view.active {
            display: block;
        }

        /* Inset Corner Styles */
        .inset-corner:hover {
            background: rgba(60, 70, 90, 0.7) !important;
            border-color: rgba(130, 140, 160, 0.7) !important;
            transform: scale(1.05);
        }

        .inset-corner:hover svg {
            stroke: rgba(255, 255, 255, 0.6) !important;
        }

        /* Enabled/Active state (inset is on) */
        .inset-corner.active {
            background: rgba(59, 130, 246, 0.3) !important;
            border: 2px solid rgba(59, 130, 246, 0.7) !important;
            border-style: solid !important;
        }

        .tool-section {
            margin-bottom: 18px;
            padding-bottom: 0;
        }

        .tool-section:last-child {
            margin-bottom: 0;
        }

        /* Scenario Editor Icon Buttons - Wrapper */
        .scenario-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .scenario-icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            padding: 0;
            background: rgba(60, 70, 85, 0.3);
            border: 1px solid rgba(80, 90, 105, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: rgba(200, 205, 215, 0.85);
        }

        .scenario-icon-btn:hover {
            background: rgba(80, 90, 105, 0.4);
            border-color: rgba(100, 110, 125, 0.6);
            color: rgba(220, 225, 235, 0.95);
            transform: translateY(-2px);
        }

        .scenario-icon-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }

        .scenario-label {
            font-size: 9px;
            font-weight: 500;
            text-align: center;
            color: rgba(200, 205, 215, 0.75);
            line-height: 1.2;
        }

        .tool-section-title {
            font-size: 13px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.75);
            letter-spacing: 0.6px;
            margin-bottom: 10px;
            padding: 6px 0;
        }

        .tool-item {
            padding: 11px 11px;
            background: rgba(45, 53, 64, 0.2);
            border-radius: 5px;
            margin-bottom: 6px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-item:hover {
            background: rgba(59, 130, 246, 0.15);
            border-left: 3px solid #3b82f6;
            padding-left: 8px;
        }

        .tool-item-group {
            margin-bottom: 4px;
        }

        .tool-item-inline {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-item-inline .tool-label {
            margin-bottom: 0;
            flex-shrink: 0;
            min-width: fit-content;
        }

        .tool-input-inline {
            flex: 1;
            min-width: 0;
        }

        .tool-item-inline .tool-btn-secondary {
            flex: 1;
            margin-bottom: 0;
        }

        .tool-label {
            display: block;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .tool-input {
            width: 100%;
            padding: 8px 10px;
            background: rgba(45, 53, 64, 0.4);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            transition: all 0.2s;
            height: 34px;
            box-sizing: border-box;
        }

        .tool-input:focus {
            outline: none;
            border-color: rgba(140, 150, 165, 0.8);
            background: rgba(70, 80, 95, 0.2);
        }

        /* Style number input spinner arrows to white */
        .tool-input[type="number"]::-webkit-inner-spin-button,
        .tool-input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
            filter: invert(1);
        }

        .tool-select {
            width: 100%;
            padding: 8px 10px;
            background: rgba(45, 53, 64, 0.4);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            height: 34px;
            box-sizing: border-box;
        }

        .tool-select:focus {
            outline: none;
            border-color: rgba(140, 150, 165, 0.8);
        }

        .tool-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            cursor: pointer;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 2px;
        }

        .tool-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            background-color: rgba(30, 38, 50, 0.65);
            border: 1.5px solid rgba(100, 110, 125, 0.5);
            border-radius: 3px;
            appearance: none;
            -webkit-appearance: none;
            position: relative;
        }

        .tool-checkbox input[type="checkbox"]:checked {
            background-color: rgba(70, 80, 95, 0.5);
            border-color: rgba(120, 130, 145, 0.7);
        }

        .tool-checkbox input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 1px;
            width: 4px;
            height: 8px;
            border: solid rgba(220, 225, 230, 0.9);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }


        .tool-btn {
            width: 100%;
            padding: 9px 10px;
            background: rgba(90, 97, 112, 0.3);
            border: 1px solid rgba(120, 130, 145, 0.5);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            height: 34px;
            box-sizing: border-box;
        }

        .tool-btn:hover {
            background: rgba(120, 130, 145, 0.4);
            border-color: rgba(140, 150, 165, 0.6);
        }

        .tool-btn svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .tool-btn-secondary {
            width: 100%;
            padding: 9px 10px;
            background: rgba(90, 97, 112, 0.3);
            border: 1px solid rgba(120, 130, 145, 0.5);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 5px;
            height: 34px;
            box-sizing: border-box;
        }

        .tool-btn-secondary:hover {
            background: rgba(120, 130, 145, 0.4);
            border-color: rgba(140, 150, 165, 0.6);
        }

        .tool-button-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 8px;
            margin-top: 6px;
        }

        .tool-btn-small {
            padding: 6px 4px;
            background: rgba(90, 97, 112, 0.3);
            border: 1px solid rgba(120, 130, 145, 0.5);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 29px;
            box-sizing: border-box;
        }

        .tool-btn-small:hover {
            background: rgba(120, 130, 145, 0.4);
            border-color: rgba(140, 150, 165, 0.6);
        }

        .tool-btn-small svg {
            flex-shrink: 0;
        }

        .tool-vector-list,
        .tool-inset-list,
        .tool-route-list {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            padding: 6px 0;
        }

        .toggle-tool-pane-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .toggle-tool-pane-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .toggle-tool-pane-btn svg {
            width: 18px;
            height: 18px;
        }

        .radar-zone {
            flex: 1;
            width: 100%;
            height: 100%;
            background: rgba(18, 22, 28, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 0;
            border: none;
            box-shadow: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            margin: 0;
            z-index: 1;
        }

        .main-container.fullscreen .radar-zone {
            border-radius: 0;
            border: none;
        }

        .radar-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #2d3540;
            border-radius: 0;
        }

        .main-container.fullscreen .radar-container {
            border-radius: 0;
        }

        #radarCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 0;
        }

        .main-container.fullscreen #radarCanvas {
            border-radius: 0;
        }

        .entities-zone {
            width: 320px;
            min-width: 220px;
            max-width: 450px;
            background: rgba(30, 38, 50, 0.65);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 0;
            border: none;
            border-left: 1px solid rgba(57, 65, 80, 0.4);
            box-shadow: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: 100;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .entities-zone.profiles-mode {
            width: 520px;
        }

        .entities-zone.resizing {
            transition: none;
        }

        .main-container.fullscreen .entities-zone {
            top: 0;
            right: 0;
            bottom: 0;
        }

        .fullscreen-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            background: rgba(36, 43, 54, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 8px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .fullscreen-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
            color: #3b82f6;
            transform: scale(1.05);
        }

        .fullscreen-btn svg {
            width: 18px;
            height: 18px;
        }

        .main-container.fullscreen .fullscreen-btn {
            right: calc(420px + 40px); /* List width + spacing on both sides */
        }

        .file-menu-container {
            position: absolute;
            display: flex;
            align-items: center;
            margin-right: 0;
            margin-left: 0;
            padding-left: 0;
            left: 4px;
            z-index: 3000;
        }

        .file-menu-btn {
            width: 40px;
            height: 40px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
            color: rgba(255, 255, 255, 0.4);
        }

        .file-menu-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.8);
        }

        .file-menu-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }

        .file-menu-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: auto;
            background: rgba(36, 43, 54, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 8px;
            padding: 6px;
            display: none;
            flex-direction: column;
            gap: 2px;
            min-width: 180px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 3000;
        }

        .file-menu-container.open .file-menu-dropdown {
            display: flex;
        }

        .file-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .file-menu-item:hover {
            background: rgba(90, 97, 112, 0.3);
        }

        .file-menu-item svg {
            width: 18px;
            height: 18px;
            color: rgba(255, 255, 255, 0.7);
            flex-shrink: 0;
        }

        .file-menu-item span {
            flex: 1;
        }

        .file-menu-separator {
            height: 1px;
            background: rgba(57, 65, 80, 0.5);
            margin: 4px 0;
        }

        .zoom-controls {
            position: absolute;
            top: 60px;
            right: 340px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 1500;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: rgba(36, 43, 54, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-size: 16px;
            font-weight: 600;
        }

        .zoom-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
            color: #3b82f6;
            transform: scale(1.05);
        }

        .zoom-btn.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
            color: #3b82f6;
        }

        .zoom-btn svg {
            width: 18px;
            height: 18px;
        }

        .zoom-btn.preset {
            font-size: 11px;
            font-family: monospace;
        }

        .zoom-btn.spacer {
            margin-bottom: 8px;
        }

        .zoom-btn.center {
            font-size: 12px;
            font-weight: 700;
        }

        /* Custom instant tooltips */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 20, 25, 0.95);
            color: #ffffff;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 10000;
            border: 1px solid rgba(57, 65, 80, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        [data-tooltip]:hover::after {
            opacity: 1;
        }

        .aircraft-details {
            padding: 10px 12px;
            background: linear-gradient(180deg, 
                rgba(38, 46, 60, 0.98) 0%, 
                rgba(28, 35, 48, 0.96) 40%, 
                rgba(18, 24, 35, 0.94) 100%);
            border-bottom: 1px solid rgba(57, 65, 80, 0.4);
            display: none;
            flex-direction: column;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(74, 85, 104, 0.5) rgba(30, 38, 50, 0.3);
            scrollbar-gutter: stable;
            box-sizing: border-box;
        }

        .aircraft-details::-webkit-scrollbar {
            width: 6px;
        }

        .aircraft-details::-webkit-scrollbar-track {
            background: rgba(30, 38, 50, 0.3);
        }

        .aircraft-details::-webkit-scrollbar-thumb {
            background: rgba(74, 85, 104, 0.5);
            border-radius: 3px;
        }

        .aircraft-details::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 85, 104, 0.7);
        }

        .aircraft-details.visible {
            display: flex;
        }

        .details-resize-handle {
            height: 6px;
            background: rgba(57, 65, 80, 0.4);
            cursor: ns-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .details-resize-handle:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .details-resize-handle::before {
            content: '';
            width: 32px;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 1px;
        }

        .details-resize-handle:hover::before {
            background: rgba(255, 255, 255, 0.4);
        }

        .details-top-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 4px;
        }

        .aircraft-icon-compact {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.25);
            border-radius: 8px;
            flex-shrink: 0;
        }

        .aircraft-icon-compact svg {
            width: 20px;
            height: 20px;
            color: #60a5fa;
        }

        .details-title {
            flex: 1;
            min-width: 0;
        }

        .details-callsign-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .details-callsign {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.5px;
        }

        #scenarioName {
            font-size: 15px;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.3;
        }

        .details-type {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        .details-status-badge {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .details-status-badge.airborne {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.2), rgba(52, 211, 153, 0.1));
            color: #34d399;
            border: 1px solid rgba(52, 211, 153, 0.3);
        }

        .details-status-badge.ground {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.1));
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .details-data-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }

        .details-section {
            margin-bottom: 2px;
        }

        .details-section:last-child {
            margin-bottom: 0;
        }

        /* Hide airborne-only sections by default */
        .details-section.airborne-only {
            display: none;
        }

        /* Show airborne-only sections when aircraft is airborne */
        .aircraft-details.airborne .details-section.airborne-only {
            display: block;
        }

        /* Hide ground-only sections by default */
        .details-section.ground-only-section {
            display: none;
        }

        /* Show ground-only sections when aircraft is grounded */
        .aircraft-details.grounded .details-section.ground-only-section {
            display: block;
        }

        /* Hide ground-only cells by default */
        .data-cell.ground-only {
            display: none;
        }

        /* Show ground-only cells when aircraft is grounded */
        .aircraft-details.grounded .data-cell.ground-only {
            display: flex;
        }

        /* Hide ground-only cells when aircraft is airborne */
        .aircraft-details.airborne .data-cell.ground-only {
            display: none;
        }

        #scenarioInfo .details-section {
            margin-bottom: 2px;
        }

        /* More spacious padding for scenario info */
        #scenarioInfo {
            padding: 10px 12px;
        }

        #scenarioInfo .details-section {
            margin-bottom: 6px;
        }

        #scenarioInfo .details-top-row {
            margin-bottom: 12px;
            padding-bottom: 4px;
        }

        #scenarioInfo .data-cell {
            padding: 5px 6px;
        }

        /* Blue color for local time */
        #scenarioTimeLocal {
            color: rgba(100, 180, 255, 0.95);
        }

        .details-section-label {
            font-size: 10px;
            color: rgba(100, 160, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
            padding-left: 2px;
            font-weight: 600;
        }

        #scenarioInfo .details-section-label {
            margin-bottom: 4px;
        }

        .details-data-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, 62px);
            gap: 2px;
            margin-bottom: 2px;
        }

        /* Keep same fixed widths in profiles mode */
        .entities-zone.profiles-mode .details-data-row {
            grid-template-columns: repeat(auto-fill, 62px);
            gap: 4px;
        }

        #scenarioInfo .details-data-row {
            grid-template-columns: repeat(auto-fill, 62px);
            gap: 6px;
        }

        #scenarioInfo .details-section:last-child .details-data-row {
            grid-template-columns: repeat(auto-fill, 62px);
            gap: 6px;
        }

        .details-data-row:last-child {
            margin-bottom: 0;
        }

        .data-cell {
            padding: 3px 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 62px;
            box-sizing: border-box;
        }

        /* Same width in profiles mode, just more padding */
        .entities-zone.profiles-mode .data-cell {
            padding: 4px 6px;
            width: 62px;
        }

        .data-cell-label {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            text-align: center;
            word-wrap: break-word;
            width: 100%;
            line-height: 1.2;
        }

        .data-cell-value {
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .data-cell-value.highlight {
            color: #34d399;
        }

        .data-cell-value.warning {
            color: #fbbf24;
        }

        .data-cell-unit {
            font-size: 10px;
            color: rgba(180, 180, 190, 0.7);
            font-weight: 500;
            margin-left: 2px;
        }

        .entities-header {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(57, 65, 80, 0.4);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(20, 26, 35, 0.8), rgba(15, 20, 28, 0.6));
            gap: 8px;
        }

        .entities-title {
            display: none;
        }

        .entity-categories {
            display: flex;
            gap: 4px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .hide-panel-btn {
            display: none;
        }

        .entities-zone.hidden {
            transform: translateX(320px);
        }

        /* Right Panel Collapse Handle */
        .entity-collapse-handle {
            position: absolute;
            right: 320px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 64px;
            background: rgba(40, 50, 65, 0.98);
            border: 1px solid rgba(80, 95, 115, 0.8);
            border-right: none;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 102;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
        }

        .entity-collapse-handle:hover {
            background: rgba(55, 70, 90, 0.98);
            border-color: rgba(100, 120, 145, 0.9);
            width: 20px;
        }

        .entity-collapse-handle svg {
            width: 10px;
            height: 10px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.2s;
        }

        .entity-collapse-handle:hover svg {
            color: rgba(255, 255, 255, 1);
        }

        .entities-zone.hidden ~ .entity-collapse-handle {
            right: 0;
            border-left: 1px solid rgba(80, 95, 115, 0.8);
            border-right: none;
            border-radius: 8px 0 0 8px;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
        }

        .entities-zone.hidden ~ .entity-collapse-handle:hover {
            right: 0;
            width: 20px;
        }

        .entities-zone.hidden ~ .entity-collapse-handle svg {
            transform: rotate(180deg);
        }

        .show-panel-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 8px 12px;
            background: rgba(36, 43, 54, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
            align-items: center;
            gap: 6px;
            z-index: 1500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .show-panel-btn.visible {
            display: none;
        }

        .show-panel-btn:hover {
            background: rgba(45, 53, 68, 0.95);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .show-panel-btn svg {
            width: 18px;
            height: 18px;
        }

        .category-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            background: rgba(45, 53, 68, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .category-btn:hover {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
            color: #ffffff;
            transform: translateY(-1px);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
        }

        .category-btn svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .category-count {
            display: none;
        }

        .entities-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .map-controls {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: rgba(36, 43, 54, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 6px;
            border-radius: 12px;
            border: 1px solid rgba(57, 65, 80, 0.5);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .map-btn {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.2px;
        }

        .map-btn:hover {
            background: rgba(59, 130, 246, 0.15);
            color: #ffffff;
        }

        .map-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .aircraft-table {
            flex: 1;
            overflow-y: auto;
            padding: 6px 4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
        }

        .aircraft-table::-webkit-scrollbar {
            display: none;
        }

        .table-header {
            display: flex;
            gap: 0;
            padding: 4px 8px;
            background: linear-gradient(180deg, rgba(15, 20, 25, 0.6), rgba(15, 20, 25, 0.4));
            backdrop-filter: blur(10px);
            font-size: 9px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.45);
            border-bottom: 1px solid rgba(57, 65, 80, 0.4);
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin: 0 4px 1px 4px;
            border-radius: 4px;
            z-index: 10;
        }

        .table-header-left {
            display: flex;
            gap: 0;
            align-items: center;
            flex-shrink: 0;
        }

        .table-header-callsign {
            width: 70px;
        }

        .table-header-data {
            display: grid;
            grid-template-columns: 0.9fr 0.6fr 0.6fr 0.6fr;
            gap: 4px;
            width: 180px;
            transition: opacity 0.3s ease;
        }

        .entities-zone.profiles-mode .table-header-data {
            display: none;
        }

        .table-header-profiles {
            flex: 1;
            padding-left: 0;
            margin-left: -30px;
            align-items: center;
            display: none;
        }

        .entities-zone.profiles-mode .table-header-profiles {
            display: flex;
        }

        .expand-all-profiles-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .expand-all-profiles-btn:hover {
            background: rgba(90, 97, 112, 0.3);
            border-color: rgba(90, 97, 112, 0.5);
            transform: scale(1.05);
        }

        .expand-all-profiles-btn svg {
            width: 16px;
            height: 16px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.2s ease;
        }

        .expand-all-profiles-btn:hover svg {
            color: #ffffff;
        }

        .expand-all-profiles-btn.active {
            background: rgba(90, 97, 112, 0.4);
            border-color: rgba(90, 97, 112, 0.6);
        }

        .expand-all-profiles-btn.active svg {
            color: #ffffff;
        }

        .table-row {
            display: flex;
            gap: 0;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            margin: 0px 4px;
            border-radius: 4px;
            align-items: center;
            border: 1px solid transparent;
        }

        .table-row-left {
            display: flex;
            gap: 0;
            align-items: center;
            flex-shrink: 0;
        }

        .callsign-cell {
            font-family: monospace;
            font-weight: 600;
            font-size: 12px;
            width: 70px;
        }

        .table-row-data {
            display: grid;
            grid-template-columns: 0.9fr 0.6fr 0.6fr 0.6fr;
            gap: 4px;
            width: 170px;
            align-items: center;
        }

        .entities-zone.profiles-mode .table-row-data {
            display: none;
        }

        .table-row-profile {
            flex: 1;
            padding-left: 0;
            margin-left: -30px;
            display: none;
        }

        .entities-zone.profiles-mode .table-row-profile {
            display: flex;
        }

        .row-expand-btn {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            visibility: hidden;
        }

        .entities-zone.profiles-expanded .row-expand-btn {
            visibility: hidden;
        }

        .row-expand-btn:hover {
            background: rgba(90, 97, 112, 0.3);
            border-color: rgba(90, 97, 112, 0.5);
            transform: scale(1.08);
        }

        .row-expand-btn svg {
            width: 10px;
            height: 10px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.2s ease;
        }

        .row-expand-btn:hover svg {
            color: #ffffff;
        }

        .row-expand-btn.expanded svg {
            transform: rotate(180deg);
            color: #ffffff;
        }

        .profile-canvas-container {
            height: 28px;
            padding: 1px 3px;
            background: rgba(15, 20, 28, 0.6);
            border: 1px solid rgba(57, 65, 80, 0.3);
            border-radius: 4px;
            flex: 1;
            position: relative;
        }

        .global-timeline-overlay {
            position: absolute;
            left: calc(35% + 30px);
            top: 42px;
            bottom: 0;
            width: 1px;
            background: rgba(255, 200, 0, 0.7);
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .entities-zone.profiles-mode .global-timeline-overlay {
            display: block;
        }

        .inline-profile-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .table-row.row-even {
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .table-row.inactive {
            font-style: italic;
            opacity: 0.5;
        }

        .table-row.inactive:hover {
            background: rgba(255, 255, 255, 0.02);
            opacity: 0.6;
        }

        .table-row.inactive .profile-canvas-container {
            opacity: 1;
            padding-left: calc(35% + 42px);
        }

        .table-row.selected {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.14) 0%, rgba(255, 255, 255, 0.06) 50%, rgba(255, 255, 255, 0.08) 100%);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3), 
                        0 8px 24px rgba(0, 0, 0, 0.15),
                        inset 0 1px 1px rgba(255, 255, 255, 0.25),
                        inset 0 -1px 1px rgba(255, 255, 255, 0.1);
        }

        .profile-header {
            display: none;
        }

        .profile-chart {
            width: 100%;
            height: 80px;
            position: relative;
            background: transparent;
            border-radius: 0;
            border: none;
        }

        .altitude-indicator {
            color: #34d399;
            font-weight: 600;
            text-shadow: 0 0 12px rgba(52, 211, 153, 0.4);
        }

        .timeline-container {
            display: flex;
            align-items: center;
        }

        .main-container.fullscreen .timeline-container {
            /* No changes needed for fullscreen */
        }

        .timeline-container::before {
            display: none;
        }

        .timeline-container::after {
            display: none;
        }

        .timeline-label {
            display: none;
        }

        .playback-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-buttons {
            display: flex;
            gap: 6px;
            background: transparent;
            padding: 0;
            border-radius: 0;
            border: none;
            align-items: center;
        }

        .control-btn {
            width: 29px;
            height: 29px;
            min-width: 29px;
            min-height: 29px;
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.25), rgba(74, 85, 104, 0.4));
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.9);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 10px;
            font-weight: 600;
            line-height: 1;
            flex-shrink: 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.15), transparent);
            border-radius: 50% 50% 0 0;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.4), rgba(74, 85, 104, 0.6));
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
            transform: scale(1.08);
            box-shadow: 0 5px 14px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
            color: #ffffff;
            transform: scale(1.08);
            box-shadow: 0 5px 14px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35),
                        inset 0 1px 2px rgba(0, 0, 0, 0.25);
        }

        .control-btn svg {
            width: 16px;
            height: 16px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2));
        }

        /* Make play/pause button larger */
        #btnPlay {
            width: 36px;
            height: 36px;
            min-width: 36px;
            min-height: 36px;
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.3), rgba(74, 85, 104, 0.5));
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25),
                        inset 0 -2px 6px rgba(0, 0, 0, 0.15);
        }

        #btnPlay:hover {
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.5), rgba(74, 85, 104, 0.7));
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.45),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3),
                        inset 0 -2px 6px rgba(0, 0, 0, 0.15);
        }

        #btnPlay svg {
            width: 18px;
            height: 18px;
        }

        .timeline-slider {
            width: 220px;
            min-width: 180px;
            height: 12px;
            background: rgba(45, 53, 68, 0.7);
            border-radius: 6px;
            position: relative;
            cursor: pointer;
            border: 1px solid rgba(57, 65, 80, 0.4);
            overflow: visible;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #5a6170, #4a5568);
            border-radius: 6px;
            position: relative;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
            transition: box-shadow 0.2s ease;
        }

        .timeline-slider:hover .timeline-progress {
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.5);
        }

        .timeline-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.6), rgba(74, 85, 104, 0.8));
            border-radius: 50%;
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: grab;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .timeline-thumb:hover {
            transform: translateY(-50%) scale(1.3);
            background: linear-gradient(135deg, rgba(90, 97, 112, 0.8), rgba(74, 85, 104, 1));
            box-shadow: 0 5px 14px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .timeline-thumb:active {
            cursor: grabbing;
            transform: translateY(-50%) scale(1.2);
        }

        .time-display {
            font-size: 14px;
            font-weight: 700;
            color: #3b82f6;
            min-width: 45px;
            letter-spacing: -0.5px;
        }

        .duration-display {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            min-width: 45px;
            text-align: right;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: 10px;
            padding-left: 10px;
            border-left: 1px solid rgba(57, 65, 80, 0.25);
            position: relative;
        }

        .speed-label {
            display: none;
        }

        .speed-selector {
            position: relative;
        }

        .speed-current {
            padding: 6px 10px;
            background: rgba(45, 53, 68, 0.4);
            border: 1px solid rgba(57, 65, 80, 0.4);
            border-radius: 5px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 60px;
            justify-content: space-between;
        }

        .speed-current:hover {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .speed-current::after {
            content: '';
            font-size: 10px;
            transition: transform 0.2s;
        }

        .speed-selector.open .speed-current::after {
            transform: rotate(180deg);
        }

        .speed-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: rgba(36, 43, 54, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(57, 65, 80, 0.5);
            border-radius: 6px;
            padding: 4px;
            display: none;
            flex-direction: column;
            gap: 2px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 3000;
            min-width: 80px;
            max-height: 280px;
            overflow-y: auto;
        }

        .speed-menu::-webkit-scrollbar {
            width: 6px;
        }

        .speed-menu::-webkit-scrollbar-track {
            background: rgba(45, 53, 68, 0.3);
            border-radius: 3px;
        }

        .speed-menu::-webkit-scrollbar-thumb {
            background: rgba(74, 85, 104, 0.6);
            border-radius: 3px;
        }

        .speed-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 85, 104, 0.8);
        }

        .speed-selector.open .speed-menu {
            display: flex;
        }

        .speed-option {
            padding: 11px 12px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            text-align: left;
            white-space: nowrap;
        }

        .speed-option:hover {
            background: rgba(59, 130, 246, 0.2);
            color: #ffffff;
        }

        .speed-option.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .speed-btn {
            display: none;
        }

        .scale-bar {
            position: absolute;
            bottom: 140px;
            left: 16px;
            background: rgba(36, 43, 54, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            color: #ffffff;
            border: 1px solid rgba(57, 65, 80, 0.5);
            font-weight: 600;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .radar-info {
            display: none;
        }

        .map-controls {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 1000;
            display: none;
            gap: 8px;
            background: rgba(36, 43, 54, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 6px;
            border-radius: 12px;
            border: 1px solid rgba(57, 65, 80, 0.5);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        /* Custom scrollbar */
        .aircraft-table {
            scrollbar-width: thin;
            scrollbar-color: rgba(59, 130, 246, 0.3) transparent;
        }

        .aircraft-table::-webkit-scrollbar {
            width: 5px;
        }

        .aircraft-table::-webkit-scrollbar-track {
            background: transparent;
        }

        .aircraft-table::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .aircraft-table:hover::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
        }

        .aircraft-table::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }


    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <!-- File Menu at Far Left -->
            <div class="file-menu-container" id="fileMenuContainer">
                <button class="file-menu-btn" id="fileMenuBtn" title="File Menu">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <div class="file-menu-dropdown" id="fileMenuDropdown">
                    <button class="file-menu-item" id="fileOpenBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                        <span>Open</span>
                    </button>
                    <button class="file-menu-item" id="fileSaveBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                        </svg>
                        <span>Save</span>
                    </button>
                    <button class="file-menu-item" id="fileSaveAsBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span>Save a Copy</span>
                    </button>
                    <div class="file-menu-separator"></div>
                    <button class="file-menu-item" id="fileCloseBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        <span>Close</span>
                    </button>
                </div>
            </div>
            
            <!-- Logo and Title -->
            <div class="logo">
                <div style="display: flex; align-items: center; gap: 4px;">
                    <svg width="24" height="18" viewBox="0 0 32 24" xmlns="http://www.w3.org/2000/svg">
                        <polygon points="0,24 5,12 0,0" fill="#DC2626" />
                        <polygon points="6,22 10,12 6,2" fill="#EF4444" />
                        <polygon points="12,21 15,12 12,3" fill="#DC2626" />
                        <polygon points="18,20 20,12 18,4" fill="#EF4444" />
                        <polygon points="23,19 24.5,12 23,5" fill="#DC2626" />
                    </svg>
                    <span style="font-size: 13px; font-weight: 600; letter-spacing: -0.3px; color: #ffffff;">Adacel</span>
                </div>
                <div style="height: 20px; width: 1px; background: rgba(255, 255, 255, 0.3); margin: 0 8px;"></div>
                <div>
                    <h1 style="font-size: 13px; font-weight: 600; letter-spacing: -0.3px; color: #ffffff; line-height: 1.2;">
                        Scenario Quick Preview <span style="background: #0891b2; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 6px;">v7</span>
                    </h1>
                </div>
            </div>
        </div>
        <div class="header-right" style="gap: 8px;">
            <button class="toggle-tool-pane-btn" id="toggleToolPaneBtn" title="Toggle Tool Pane">
                <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                    <rect x="2.5" y="3" width="6.5" height="18" rx="1.5" id="toolPaneIndicator" style="opacity: 0.3"/>
                    <rect x="11" y="3" width="11" height="18" rx="1.5" opacity="0.6"/>
                </svg>
            </button>
            <button class="toggle-panel-btn" id="togglePanelBtn" title="Toggle Entity List">
                <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                    <rect x="1.5" y="2" width="13" height="20" rx="1.5" opacity="0.6"/>
                    <rect x="16" y="2" width="6.5" height="20" rx="1.5" id="panelIndicator"/>
                </svg>
            </button>
            <button class="header-close-btn" id="headerCloseBtn" title="Close" style="margin-left: 12px;">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Secondary Toolbar -->
    <div class="secondary-toolbar" id="secondaryToolbar">
        <!-- Scenario Info -->
        <div class="toolbar-scenario">
            <div class="toolbar-scenario-icon">
                <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
            </div>
            <div class="toolbar-scenario-info">
                <span class="toolbar-scenario-name" id="toolbarScenarioName">Arrival 27L Heavy</span>
                <span class="toolbar-scenario-airport" id="toolbarAirport">KORD - Chicago O'Hare International Airport</span>
            </div>
        </div>
        
        <div class="playback-container">
            <div class="timeline-container">
                <div class="playback-controls">
                    <div class="control-buttons">
                        <button class="control-btn" id="btnPrev">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M11.5 12L20 18V6l-8.5 6zm-.5 6l-8.5-6L11 6v12z"/>
                            </svg>
                        </button>
                        <button class="control-btn" id="btnPlay">
                            <svg id="playIcon" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5.14v14.72L19 12z"/>
                            </svg>
                            <svg id="pauseIcon" fill="currentColor" viewBox="0 0 24 24" style="display: none;">
                                <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                            </svg>
                        </button>
                        <button class="control-btn" id="btnNext">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M13 6v12l8.5-6zm-9 12V6l8.5 6z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="time-display" id="currentTime">00:17</div>
                    <div class="timeline-slider" id="timelineSlider">
                        <div class="timeline-progress" id="timelineProgress" style="width: 1%;">
                            <div class="timeline-thumb"></div>
                        </div>
                    </div>
                    <div class="duration-display">60:00</div>
                    <div class="speed-control">
                        <div class="speed-selector" id="speedSelector">
                            <div class="speed-current" id="speedCurrent">1x</div>
                            <div class="speed-menu" id="speedMenu">
                                <button class="speed-option" data-speed="0.1">0.1x</button>
                                <button class="speed-option" data-speed="0.25">0.25x</button>
                                <button class="speed-option" data-speed="0.5">0.5x</button>
                                <button class="speed-option" data-speed="0.75">0.75x</button>
                                <button class="speed-option active" data-speed="1">1x</button>
                                <button class="speed-option" data-speed="1.5">1.5x</button>
                                <button class="speed-option" data-speed="2">2x</button>
                                <button class="speed-option" data-speed="4">4x</button>
                                <button class="speed-option" data-speed="5">5x</button>
                                <button class="speed-option" data-speed="10">10x</button>
                                <button class="speed-option" data-speed="20">20x</button>
                                <button class="speed-option" data-speed="50">50x</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Weather Display -->
        <div class="toolbar-weather">
            <div class="toolbar-weather-item">
                <span class="toolbar-weather-label">QNH</span>
                <span class="toolbar-weather-value" id="toolbarQNH">29.92</span>
            </div>
            <div class="toolbar-weather-item">
                <span class="toolbar-weather-label">Wind</span>
                <span class="toolbar-weather-value" id="toolbarWind">270 / 12kt</span>
            </div>
            <div class="toolbar-weather-item">
                <span class="toolbar-weather-label">Gust</span>
                <span class="toolbar-weather-value" id="toolbarGust">18kt</span>
            </div>
        </div>
    </div>

    <!-- Top Toolbar Section -->

    <div class="main-container">
        <!-- Vertical Icon Toolbar (Far Left) -->
        <div class="vertical-toolbar" id="verticalToolbar">
            <div class="toolbar-icons-top">
                <button class="toolbar-icon-btn active" id="toolbarDisplayBtn" data-pane="display" title="Display">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <!-- Outer circle -->
                        <circle cx="12" cy="12" r="9" stroke-width="1.5"/>
                        <!-- Inner circle (faded) -->
                        <circle cx="12" cy="12" r="6" stroke-width="1.2" opacity="0.4"/>
                        <!-- Crosshairs -->
                        <path stroke-width="1" opacity="0.5" d="M12 3 L12 21 M3 12 L21 12"/>
                        <!-- Angled sweep line (45 degrees) -->
                        <path stroke-linecap="round" stroke-width="2" d="M12 12 L18.36 5.64"/>
                        <!-- Aircraft blips -->
                        <circle cx="8" cy="8" r="1" fill="currentColor"/>
                        <circle cx="16" cy="10" r="1" fill="currentColor"/>
                        <circle cx="14" cy="16" r="1" fill="currentColor"/>
                        <!-- Center dot -->
                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                    </svg>
                </button>
                <button class="toolbar-icon-btn" id="toolbarTargetBtn" data-pane="aircraft" title="Target">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                    </svg>
                </button>
                <button class="toolbar-icon-btn" id="toolbarViewsBtn" data-pane="views" title="Inset Window">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <!-- Main screen outline -->
                        <rect x="2" y="4" width="20" height="16" rx="1" stroke-width="1.5"/>
                        <!-- Top-left inset -->
                        <rect x="4" y="6" width="5" height="4" rx="0.5" stroke-width="1" fill="none"/>
                        <!-- Top-right inset -->
                        <rect x="15" y="6" width="5" height="4" rx="0.5" stroke-width="1" fill="none"/>
                        <!-- Bottom-left inset -->
                        <rect x="4" y="14" width="5" height="4" rx="0.5" stroke-width="1" fill="none"/>
                        <!-- Bottom-right inset -->
                        <rect x="15" y="14" width="5" height="4" rx="0.5" stroke-width="1" fill="none"/>
                    </svg>
                </button>
            </div>
            <div class="toolbar-icons-bottom">
                <button class="toolbar-icon-btn" id="toolbarSettingsBtn" data-panel="settings" title="Settings">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tool Pane (Display Panel) -->
        <div class="tool-pane" id="toolPane">
            <div class="tool-pane-header">
                <h3 style="font-size: 13px; font-weight: 600; color: #ffffff; margin: 0;" id="toolPaneTitle">Display</h3>
            </div>
            <div class="tool-pane-content" id="toolPaneContent">
                <!-- Display Pane -->
                <div class="tool-pane-view active" data-pane="display">
                <!-- Display Options -->
                <div class="tool-section">
                    <div class="tool-section-title" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Display Options</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="compassRoseToggle" checked>
                            <span style="font-size: 11px; font-weight: 400;">Compass Rose</span>
                        </label>
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="autotagsToggle" checked>
                            <span style="font-size: 11px; font-weight: 400;">Autotags</span>
                        </label>
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="weatherToggle">
                            <span style="font-size: 11px; font-weight: 400;">Weather Radar Image</span>
                        </label>
                    </div>
                </div>
                <div class="tool-section" style="margin-top: 8px;">
                    <div class="tool-section-title" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Range & View</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Range (NM)</label>
                            <input type="number" class="tool-input" value="80" min="5" max="200" id="rangeInput" style="width: 70px; padding: 4px 8px; font-size: 11px; height: auto;">
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                        <button class="tool-btn" id="zoomAreaBtn" style="width: 152px; min-width: 0; justify-content: center; margin-top: 8px; font-size: 11px; padding: 5px 8px; height: auto;">
                            Zoom to Area
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 12px; height: 12px;">
                                <rect x="3" y="3" width="18" height="18" stroke-width="2" stroke-dasharray="4 2"/>
                            </svg>
                        </button>
                        <button class="tool-btn" id="zoomPreviousBtn" style="width: 152px; min-width: 0; justify-content: center; font-size: 11px; padding: 5px 8px; height: auto;">
                            Previous Range & Center
                        </button>
                        <button class="tool-btn" id="setCenterBtn" style="width: 152px; min-width: 0; justify-content: center; font-size: 11px; padding: 5px 8px; height: auto;">
                            Recenter (Click Map)
                        </button>
                    </div>
                </div>

                <!-- Vectors -->
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Vectors</span>
                    </div>
                    
                    <div style="display: flex; gap: 6px;">
                        <!-- Canvas area -->
                        <div style="flex: 1; background: rgba(25, 30, 38, 0.8); border: 1px solid rgba(70, 80, 95, 0.5); border-radius: 6px; min-height: 120px; position: relative; padding: 8px;">
                            <!-- Vector items -->
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <div style="font-size: 11px; color: rgba(255, 255, 255, 0.7); font-weight: 400;">vector1</div>
                                <div style="font-size: 11px; color: rgba(255, 255, 255, 0.7); font-weight: 400;">vector2</div>
                            </div>
                            
                            <!-- Drag handle -->
                            <div style="position: absolute; bottom: 8px; right: 8px; color: rgba(255, 255, 255, 0.3); display: grid; grid-template-columns: repeat(2, 4px); gap: 2px;">
                                <div style="width: 4px; height: 4px; background: currentColor; border-radius: 50%;"></div>
                                <div style="width: 4px; height: 4px; background: currentColor; border-radius: 50%;"></div>
                                <div style="width: 4px; height: 4px; background: currentColor; border-radius: 50%;"></div>
                                <div style="width: 4px; height: 4px; background: currentColor; border-radius: 50%;"></div>
                            </div>
                        </div>
                        
                        <!-- Control buttons -->
                        <div style="display: flex; flex-direction: column; gap: 3px;">
                            <button style="background: rgba(60, 70, 85, 0.5); border: 1px solid rgba(100, 110, 125, 0.4); border-radius: 3px; cursor: pointer; color: rgba(255, 255, 255, 0.7); padding: 4px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;" title="Add Vector">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 12px; height: 12px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                            </button>
                            <button style="background: rgba(60, 70, 85, 0.5); border: 1px solid rgba(100, 110, 125, 0.4); border-radius: 3px; cursor: pointer; color: rgba(255, 255, 255, 0.7); padding: 4px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;" title="Remove Vector">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 12px; height: 12px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>



                <!-- Alert Systems -->
                <div class="tool-section">
                    <div class="tool-section-title" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Alert Systems</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="stcaToggle">
                            <span style="font-size: 11px; font-weight: 400;">STCA (Short Term Conflict Alert)</span>
                        </label>
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="apwToggle">
                            <span style="font-size: 11px; font-weight: 400;">APW (Area Proximity Warning)</span>
                        </label>
                        <label class="tool-checkbox" style="padding: 2px 0;">
                            <input type="checkbox" id="msawToggle">
                            <span style="font-size: 11px; font-weight: 400;">MSAW (Min Safe Altitude Warning)</span>
                        </label>
                    </div>
                </div>


                </div>
                <!-- End Display Pane -->

                <!-- Aircraft Pane -->
                <div class="tool-pane-view" data-pane="aircraft">
                <!-- History Trail -->
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">History Trail</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Trail Dots</label>
                            <select class="tool-select" id="trailDotsSelect" style="width: 50px; flex: none; font-size: 11px; padding: 4px 8px; height: auto;">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="99">99</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Predicted Track Line (PTL) -->
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Predicted Track Line</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Length</label>
                            <select class="tool-select" id="ptlLengthInput" style="width: 50px; flex: none; font-size: 11px; padding: 4px 8px; height: auto;">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                            <select class="tool-select" id="ptlTypeSelect" style="width: 63px; flex: none; font-size: 11px; padding: 4px 8px; height: auto;">
                                <option value="nm">NM</option>
                                <option value="min">mins</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Flight Plan Routes -->
                <div class="tool-section" style="margin-bottom: 8px;">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Flight Plan Routes (0/5)</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Type</label>
                            <select class="tool-select" id="routeTypeSelect" style="width: 100%; flex: 1; font-size: 11px; padding: 4px 8px; height: auto;">
                                <option value="hist-pred" selected>Historical + Predicted</option>
                                <option value="hist">Historical</option>
                                <option value="pred">Predicted</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Label Override -->
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 4px 0;">
                        <span style="font-size: 11px; font-weight: 700; letter-spacing: 0;">Label Override</span>
                    </div>
                    <div style="padding-left: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Label Orientation ()</label>
                            <input type="number" class="tool-input" value="45" min="0" max="359" step="45" id="labelOrientationInput" style="width: 60px; flex: none; font-size: 11px; padding: 4px 8px; height: auto;">
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">Leader Line Length</label>
                            <select class="tool-select" id="labelLeaderSelect" style="width: 100%; flex: 1; font-size: 11px; padding: 4px 8px; height: auto;">
                                <option value="short">Short</option>
                                <option value="medium" selected>Medium</option>
                                <option value="long">Long</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Apply buttons for all Target pane parameters -->
                <div style="display: flex; gap: 4px; margin-top: 20px; justify-content: center;">
                    <button class="tool-btn-small" id="applyTargetBtn" style="padding: 5px 8px; width: 70px; font-size: 11px; height: auto;">Apply</button>
                    <button class="tool-btn-small" id="applyAllTargetBtn" style="padding: 5px 8px; width: 80px; font-size: 11px; height: auto;">Apply All</button>
                </div>
                </div>
                <!-- End Aircraft Pane -->

                <!-- Views Pane -->
                <div class="tool-pane-view" data-pane="views">
                <!-- Inset Position Selector -->
                <div class="tool-section">
                    <!-- Visual Screen Template -->
                    <div class="inset-screen-template" id="insetScreenTemplate" style="
                        width: 100%;
                        aspect-ratio: 16/10;
                        background: rgba(20, 25, 35, 0.9);
                        border: 2px solid rgba(80, 90, 110, 0.6);
                        border-radius: 6px;
                        position: relative;
                        margin-bottom: 12px;
                        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.4);
                    ">
                        <!-- Center label -->
                        <div style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            font-size: 10px;
                            color: rgba(255, 255, 255, 0.2);
                            text-transform: uppercase;
                            letter-spacing: 1px;
                        ">Inset Window</div>
                        
                        <!-- Top-Left Inset -->
                        <div class="inset-corner" id="insetTopLeft" data-position="top-left" style="
                            position: absolute;
                            top: 8px;
                            left: 8px;
                            width: 60px;
                            height: 45px;
                            background: rgba(40, 50, 65, 0.6);
                            border: 2px dashed rgba(100, 110, 130, 0.5);
                            border-radius: 4px;
                            cursor: pointer;
                            transition: all 0.2s;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-direction: column;
                            gap: 2px;
                        ">
                            <svg class="inset-plus-icon" fill="none" stroke="rgba(255,255,255,0.3)" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="inset-label" style="display: none; font-size: 7px; color: rgba(255,255,255,0.8); text-align: center; line-height: 1.2;"></span>
                        </div>
                        
                        <!-- Top-Right Inset -->
                        <div class="inset-corner" id="insetTopRight" data-position="top-right" style="
                            position: absolute;
                            top: 8px;
                            right: 8px;
                            width: 60px;
                            height: 45px;
                            background: rgba(40, 50, 65, 0.6);
                            border: 2px dashed rgba(100, 110, 130, 0.5);
                            border-radius: 4px;
                            cursor: pointer;
                            transition: all 0.2s;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-direction: column;
                            gap: 2px;
                        ">
                            <svg class="inset-plus-icon" fill="none" stroke="rgba(255,255,255,0.3)" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="inset-label" style="display: none; font-size: 7px; color: rgba(255,255,255,0.8); text-align: center; line-height: 1.2;"></span>
                        </div>
                        
                        <!-- Bottom-Left Inset -->
                        <div class="inset-corner" id="insetBottomLeft" data-position="bottom-left" style="
                            position: absolute;
                            bottom: 8px;
                            left: 8px;
                            width: 60px;
                            height: 45px;
                            background: rgba(40, 50, 65, 0.6);
                            border: 2px dashed rgba(100, 110, 130, 0.5);
                            border-radius: 4px;
                            cursor: pointer;
                            transition: all 0.2s;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-direction: column;
                            gap: 2px;
                        ">
                            <svg class="inset-plus-icon" fill="none" stroke="rgba(255,255,255,0.3)" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="inset-label" style="display: none; font-size: 7px; color: rgba(255,255,255,0.8); text-align: center; line-height: 1.2;"></span>
                        </div>
                        
                        <!-- Bottom-Right Inset -->
                        <div class="inset-corner" id="insetBottomRight" data-position="bottom-right" style="
                            position: absolute;
                            bottom: 8px;
                            right: 8px;
                            width: 60px;
                            height: 45px;
                            background: rgba(40, 50, 65, 0.6);
                            border: 2px dashed rgba(100, 110, 130, 0.5);
                            border-radius: 4px;
                            cursor: pointer;
                            transition: all 0.2s;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-direction: column;
                            gap: 2px;
                        ">
                            <svg class="inset-plus-icon" fill="none" stroke="rgba(255,255,255,0.3)" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="inset-label" style="display: none; font-size: 7px; color: rgba(255,255,255,0.8); text-align: center; line-height: 1.2;"></span>
                        </div>
                        
                        <!-- Popup Config Panel -->
                        <div class="inset-popup" id="insetPopup" style="
                            display: none;
                            position: absolute;
                            background: rgba(35, 42, 55, 0.98);
                            border: 1px solid rgba(100, 110, 130, 0.6);
                            border-radius: 8px;
                            padding: 12px;
                            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
                            z-index: 10;
                            min-width: 140px;
                        ">
                            <div style="font-size: 10px; font-weight: 600; color: rgba(255,255,255,0.9); margin-bottom: 10px; text-transform: uppercase;" id="popupTitle">Add Inset</div>
                            
                            <div style="margin-bottom: 8px;">
                                <label style="font-size: 10px; color: rgba(255,255,255,0.5); display: block; margin-bottom: 3px;">View</label>
                                <select id="popupViewSelect" style="width: 100%; font-size: 11px; padding: 4px 6px; background: rgba(50,60,75,0.8); border: 1px solid rgba(80,90,105,0.5); border-radius: 4px; color: white;">
                                    <option value="ground">Ground</option>
                                    <option value="radar">Radar</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="font-size: 10px; color: rgba(255,255,255,0.5); display: block; margin-bottom: 3px;">Range (NM)</label>
                                <input type="number" id="popupRangeInput" value="5" min="1" max="20" style="width: 100%; font-size: 11px; padding: 4px 6px; background: rgba(50,60,75,0.8); border: 1px solid rgba(80,90,105,0.5); border-radius: 4px; color: white; box-sizing: border-box;">
                            </div>
                            
                            <div style="display: flex; gap: 6px;">
                                <button id="popupConfirmBtn" style="flex: 1; padding: 5px 8px; font-size: 10px; background: rgba(59,130,246,0.8); border: none; border-radius: 4px; color: white; cursor: pointer;">Add</button>
                                <button id="popupRemoveBtn" style="flex: 1; padding: 5px 8px; font-size: 10px; background: rgba(239,68,68,0.7); border: none; border-radius: 4px; color: white; cursor: pointer; display: none;">Remove</button>
                                <button id="popupCancelBtn" style="flex: 1; padding: 5px 8px; font-size: 10px; background: rgba(80,90,105,0.6); border: none; border-radius: 4px; color: white; cursor: pointer;">Cancel</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div style="font-size: 10px; color: rgba(255, 255, 255, 0.5); text-align: center;">
                        Click a corner to add or edit inset  <span id="activeInsetsCount">0</span>/4 enabled
                    </div>
                </div>
                </div>
                <!-- End Views Pane -->
            </div>
        </div>

        <!-- Scenario Editor Pane (Hidden by default) -->
        <div class="tool-pane" id="scenarioPane" style="display: none;">
            <div class="tool-pane-header">
                <h3 style="font-size: 13px; font-weight: 600; color: #ffffff; margin: 0;">Scenario Editor</h3>
            </div>
            <div class="tool-pane-content" style="padding: 16px;">
                
                <!-- Aircraft Section -->
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 12px 0;">
                        <span style="font-size: 11px; font-weight: 700;">Aircraft</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <!-- Add New Flight -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add New Flight">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </button>
                            <span class="scenario-label">New Flight</span>
                        </div>
                        
                        <!-- New Routes -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add New Route">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                                </svg>
                            </button>
                            <span class="scenario-label">New Route</span>
                        </div>
                        
                        <!-- Change Trajectory -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Modify Trajectory">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12c0 2 2 4 4 4" opacity="0.5"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Trajectory</span>
                        </div>
                        
                        <!-- Edit Flight Plan -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Edit Flight Plan">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Flight Plan</span>
                        </div>
                    </div>
                </div>
                
                <!-- Weather Section -->
                <div class="tool-section" style="margin-top: 20px;">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 12px 0;">
                        <span style="font-size: 11px; font-weight: 700;">Weather</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <!-- Rain -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Rain">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15l3 3m0 0l3-3m-3 3V9m9 9l3 3m0 0l3-3m-3 3V9"/>
                                    <circle cx="12" cy="5" r="2" fill="currentColor" opacity="0.3"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Rain</span>
                        </div>
                        
                        <!-- Wind -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Wind">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Wind</span>
                        </div>
                        
                        <!-- Cumulus Clouds -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Cumulus Clouds">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Cumulus</span>
                        </div>
                        
                        <!-- Stratus Clouds -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Stratus Clouds">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15h18M3 11h18"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Stratus</span>
                        </div>
                        
                        <!-- Cumulonimbus (CB) -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Cumulonimbus (CB)">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10l-1 8" opacity="0.7"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 10l-1 6" opacity="0.5"/>
                                </svg>
                            </button>
                            <span class="scenario-label">CB</span>
                        </div>
                        
                        <!-- Fog -->
                        <div class="scenario-item">
                            <button class="scenario-icon-btn" title="Add Fog">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16h16M4 12h16M4 8h16" opacity="0.6"/>
                                </svg>
                            </button>
                            <span class="scenario-label">Fog</span>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Settings Pane (Hidden by default) -->
        <div class="tool-pane" id="settingsPane" style="display: none;">
            <div class="tool-pane-header">
                <h3 style="font-size: 13px; font-weight: 600; color: #ffffff; margin: 0;">Settings</h3>
            </div>
            <div class="tool-pane-content" style="padding: 16px;">
                <div class="tool-section">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 8px 0;">
                        <span style="font-size: 11px; font-weight: 700;">Application Settings</span>
                    </div>
                    <label class="tool-checkbox" style="padding: 4px 0;">
                        <input type="checkbox" checked>
                        <span style="font-size: 11px;">Auto-save enabled</span>
                    </label>
                    <label class="tool-checkbox" style="padding: 4px 0;">
                        <input type="checkbox">
                        <span style="font-size: 11px;">Sound effects</span>
                    </label>
                    <label class="tool-checkbox" style="padding: 4px 0;">
                        <input type="checkbox" checked>
                        <span style="font-size: 11px;">Show tooltips</span>
                    </label>
                </div>
                <div class="tool-section" style="margin-top: 16px;">
                    <div class="tool-section-title" style="padding: 6px 0; margin: 0 0 8px 0;">
                        <span style="font-size: 11px; font-weight: 700;">About</span>
                    </div>
                    <p style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin: 0; line-height: 1.5;">
                        ATC Simulator v7<br>
                        Scenario Quick Preview<br>
                         2025 Adacel
                    </p>
                </div>
            </div>
        </div>

        <!-- Collapse Handle (VS Code style) -->
        <div class="panel-collapse-handle" id="panelCollapseHandle" title="Toggle Panel">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/>
            </svg>
        </div>

        <!-- Radar Zone (Center/Main) -->
        <div class="radar-zone">
            <div class="radar-container">
                <!-- Show Panel Button (appears when list is hidden) -->
                <button class="show-panel-btn" id="showPanelBtn" title="Show Entity List">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6v12"/>
                    </svg>
                    <span>Show List</span>
                </button>

                <!-- Fullscreen Toggle -->
                <button class="fullscreen-btn" id="fullscreenBtn" title="Toggle Fullscreen">
                    <svg id="expandIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                    </svg>
                    <svg id="collapseIcon" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"/>
                    </svg>
                </button>

                <!-- Zoom Controls -->
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoomInBtn" data-tooltip="Zoom In">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                    </button>
                    <button class="zoom-btn spacer" id="zoomOutBtn" data-tooltip="Zoom Out">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                        </svg>
                    </button>
                    <button class="zoom-btn preset" data-zoom="10" data-tooltip="10 NM">10</button>
                    <button class="zoom-btn preset" data-zoom="20" data-tooltip="20 NM">20</button>
                    <button class="zoom-btn preset" data-zoom="40" data-tooltip="40 NM">40</button>
                    <button class="zoom-btn preset" data-zoom="60" data-tooltip="60 NM">60</button>
                    <button class="zoom-btn preset spacer active" data-zoom="80" data-tooltip="80 NM">80</button>
                    <button class="zoom-btn center" id="centerBtn" data-tooltip="Center View">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                    </button>
                </div>

                <div class="map-controls">
                    <button class="map-btn" id="btnSMD">SMD</button>
                    <button class="map-btn active" id="btnSRD">SRD</button>
                </div>
                <canvas id="radarCanvas"></canvas>
                <div class="scale-bar" id="scaleBar">4 NM</div>
                <div class="radar-info" id="radarInfo">AIRSPACE VIEW</div>
            </div>
        </div>

        <!-- Entities Zone (Right) -->
        <div class="entities-zone" id="entitiesZone">
            <!-- Scenario Info Panel (shown when nothing selected) -->
            <div class="aircraft-details visible" id="scenarioInfo">
                <!-- Time and Date in one row -->
                <div class="details-section" style="margin-top: 8px;">
                    <div class="details-data-row" style="justify-content: flex-start; gap: 40px; margin-left: 65px;">
                        <div class="data-cell" style="text-align: center;">
                            <div class="data-cell-label" style="font-size: 12px;">Zulu</div>
                            <div class="data-cell-value" id="scenarioTimeZulu" style="font-size: 18px; color: #34d399;">16:30:00Z</div>
                        </div>
                        <div class="data-cell" style="text-align: center;">
                            <div class="data-cell-label" style="font-size: 12px;">Date</div>
                            <div class="data-cell-value" id="scenarioDate" style="font-size: 18px;">12/04/25</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aircraft Details Panel -->
            <div class="aircraft-details" id="aircraftDetails">
                <div class="details-top-row">
                    <div class="aircraft-icon-compact">
                        <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                            <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                        </svg>
                    </div>
                    <div class="details-title">
                        <div class="details-callsign-row">
                            <span class="details-callsign" id="detailCallsign">---</span>
                            <span class="details-status-badge ground" id="detailStatusBadge">Ground</span>
                        </div>
                        <div class="details-type"><span id="detailTypeCode">---</span>  <span id="detailTypeName">---</span></div>
                    </div>
                </div>
                
                <!-- Always visible: Type, SSR, Speed -->
                <!-- First row: HDG, SPD, ALT, SSR (HDG and ALT airborne only) -->
                <div class="details-section">
                    <div class="details-data-row">
                        <div class="data-cell airborne-only">
                            <div class="data-cell-label">Hdg</div>
                            <div class="data-cell-value" id="detailHeading">000<span class="data-cell-unit"></span></div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Spd</div>
                            <div class="data-cell-value" id="detailSpeed">0<span class="data-cell-unit">kts</span></div>
                        </div>
                        <div class="data-cell airborne-only">
                            <div class="data-cell-label">Alt</div>
                            <div class="data-cell-value highlight" id="detailAltitude">0<span class="data-cell-unit">ft</span></div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">SSR</div>
                            <div class="data-cell-value" id="detailSSR">----</div>
                        </div>
                    </div>
                </div>

                <!-- Second row: Type, Turn, V/S (vertical speed - airborne only) -->
                <div class="details-section">
                    <div class="details-data-row">
                        <div class="data-cell">
                            <div class="data-cell-label">Type</div>
                            <div class="data-cell-value" id="detailTypeData">---</div>
                        </div>
                        <div class="data-cell airborne-only">
                            <div class="data-cell-label">T/S</div>
                            <div class="data-cell-value" id="detailTurnRate">0<span class="data-cell-unit">/s</span></div>
                        </div>
                        <div class="data-cell airborne-only">
                            <div class="data-cell-label">V/S</div>
                            <div class="data-cell-value" id="detailVerticalSpeed">0<span class="data-cell-unit">ft/s</span></div>
                        </div>
                    </div>
                </div>

                <!-- Ground: Dep Rte, Parking, RWY -->
                <div class="details-section ground-only-section">
                    <div class="details-data-row">
                        <div class="data-cell">
                            <div class="data-cell-label">Dep Rte</div>
                            <div class="data-cell-value" id="detailDepartureRoute">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Parking</div>
                            <div class="data-cell-value" id="detailParking">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">RWY</div>
                            <div class="data-cell-value" id="detailRwyPad">---</div>
                        </div>
                    </div>
                </div>

                <!-- Airborne only: Intent, Airway, Dep Rte, Arr Rte -->
                <div class="details-section airborne-only">
                    <div class="details-data-row">
                        <div class="data-cell">
                            <div class="data-cell-label">Intent</div>
                            <div class="data-cell-value" id="detailIntentions">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Airway</div>
                            <div class="data-cell-value" id="detailAirRoute">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Dep Rte</div>
                            <div class="data-cell-value" id="detailDepartureRouteAirborne">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Arr Rte</div>
                            <div class="data-cell-value" id="detailArrivalRoute">---</div>
                        </div>
                    </div>
                </div>

                <!-- Airborne only: Fix, Ref, Rad, Dist -->
                <div class="details-section airborne-only">
                    <div class="details-data-row">
                        <div class="data-cell">
                            <div class="data-cell-label">Fix</div>
                            <div class="data-cell-value" id="detailFix">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Ref</div>
                            <div class="data-cell-value" id="detailRef">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Rad</div>
                            <div class="data-cell-value" id="detailRad">---<span class="data-cell-unit"></span></div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Dist</div>
                            <div class="data-cell-value" id="detailDist">--<span class="data-cell-unit">nm</span></div>
                        </div>
                    </div>
                </div>

                <!-- Airborne only: Status, Action, RWY (last row) -->
                <div class="details-section airborne-only">
                    <div class="details-data-row">
                        <div class="data-cell">
                            <div class="data-cell-label">Status</div>
                            <div class="data-cell-value" id="detailStatus">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">Action</div>
                            <div class="data-cell-value" id="detailAction">---</div>
                        </div>
                        <div class="data-cell">
                            <div class="data-cell-label">RWY</div>
                            <div class="data-cell-value" id="detailRwyPadAirborne">---</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Details Resize Handle -->
            <div class="details-resize-handle" id="detailsResizeHandle"></div>

            <div class="entities-header">
                <div class="entity-categories">
                    <button class="category-btn active" data-category="aircraft" title="Aircraft">
                        <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                            <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                        </svg>
                    </button>
                    <button class="category-btn" data-category="vehicles" title="Ground Vehicles">
                        <svg fill="currentColor" stroke="none" viewBox="0 0 24 24">
                            <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        </svg>
                    </button>
                    <button class="category-btn" data-category="objects" title="Ground Objects">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                        </svg>
                    </button>
                </div>
                <div class="header-actions">
                    <button class="expand-all-profiles-btn" id="toggleProfilesBtn" title="Toggle Flight Profiles">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="entities-content">
                <div class="aircraft-table">
                    <div class="global-timeline-overlay" id="globalTimeline"></div>
                    <div class="table-header">
                        <div class="table-header-left">
                            <div class="table-header-callsign">Callsign</div>
                            <div class="table-header-data">
                                <div>Type</div>
                                <div>Level</div>
                                <div>HDG</div>
                                <div>Kts</div>
                            </div>
                        </div>
                        <div class="table-header-profiles">
                            Profile
                        </div>
                    </div>
                    <div id="entityList">
                        <!-- Entity rows will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Entity Panel Collapse Handle (VS Code style) -->
        <div class="entity-collapse-handle" id="entityCollapseHandle" title="Toggle Entity List">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/>
            </svg>
        </div>
    </div>


    <script>
        // Sample entity data
        const entities = {
            aircraft: [
                { callsign: 'AAL757', type: 'B757', level: '000', heading: '092', speed: '20', x: 0.3, y: 0.4 },
                { callsign: 'ACA18', type: 'C172', level: '000', heading: '025', speed: '20', x: 0.6, y: 0.3 },
                { callsign: 'ACA747', type: 'B747', level: '000', heading: '292', speed: '20', x: 0.7, y: 0.6 },
                { callsign: 'ANGEL1', type: 'F16', level: '000', heading: '299', speed: '20', x: 0.4, y: 0.7 },
                { callsign: 'ARR0484', type: 'F16', level: '097', heading: '138', speed: '250', x: 0.5, y: 0.5 },
                { callsign: 'H182P3', type: 'C182', level: '000', heading: '002', speed: '20', x: 0.2, y: 0.6 },
                { callsign: 'TAL0438', type: 'T38', level: '000', heading: '196', speed: '20', x: 0.8, y: 0.4 },
                { callsign: 'UAL932', type: 'B737', level: '125', heading: '180', speed: '340', x: 0.25, y: 0.35 },
                { callsign: 'DAL482', type: 'A320', level: '089', heading: '045', speed: '280', x: 0.65, y: 0.25 },
                { callsign: 'SWA1845', type: 'B738', level: '110', heading: '270', speed: '310', x: 0.75, y: 0.55 },
                { callsign: 'JBU206', type: 'A321', level: '000', heading: '180', speed: '25', x: 0.35, y: 0.65 },
                { callsign: 'UAL227', type: 'B777', level: '168', heading: '135', speed: '420', x: 0.55, y: 0.75 },
                { callsign: 'VIR32', type: 'A333', level: '145', heading: '180', speed: '390', x: 0.3, y: 0.55 },
                { callsign: 'BAW115', type: 'B789', level: '000', heading: '092', speed: '22', x: 0.4, y: 0.4 },
                // Inactive aircraft (not yet activated in scenario)
                { callsign: 'DAL1923', type: 'A321', level: '---', heading: '---', speed: '---', x: -1, y: -1, inactive: true },
                { callsign: 'UAL456', type: 'B737', level: '---', heading: '---', speed: '---', x: -1, y: -1, inactive: true },
                { callsign: 'SWA2847', type: 'B738', level: '---', heading: '---', speed: '---', x: -1, y: -1, inactive: true },
                { callsign: 'AAL2156', type: 'B777', level: '---', heading: '---', speed: '---', x: -1, y: -1, inactive: true },
                { callsign: 'FDX8291', type: 'B767', level: '---', heading: '---', speed: '---', x: -1, y: -1, inactive: true }
            ],
            vehicles: [
                { callsign: 'TRUCK01', type: 'Fuel', level: 'GND', heading: '090', speed: '15', x: 0.4, y: 0.5 },
                { callsign: 'PUSH02', type: 'Tug', level: 'GND', heading: '180', speed: '08', x: 0.5, y: 0.6 },
                { callsign: 'FIRE03', type: 'Emergency', level: 'GND', heading: '045', speed: '00', x: 0.6, y: 0.5 }
            ],
            objects: [
                { callsign: 'CONE01', type: 'Traffic Cone', level: 'GND', heading: '---', speed: '00', x: 0.35, y: 0.55 },
                { callsign: 'CONE02', type: 'Traffic Cone', level: 'GND', heading: '---', speed: '00', x: 0.36, y: 0.55 },
                { callsign: 'LIGHT01', type: 'Runway Light', level: 'GND', heading: '---', speed: '00', x: 0.5, y: 0.45 },
                { callsign: 'SIGN01', type: 'Taxiway Sign', level: 'GND', heading: '---', speed: '00', x: 0.45, y: 0.6 },
                { callsign: 'BARR01', type: 'Barrier', level: 'GND', heading: '---', speed: '00', x: 0.55, y: 0.7 }
            ]
        };

        let currentCategory = 'aircraft';
        let currentEntities = entities.aircraft;

        // Canvas setup
        const canvas = document.getElementById('radarCanvas');
        const ctx = canvas.getContext('2d');
        let currentView = 'SRD'; // SRD (airspace) or SMD (surface)
        let selectedEntity = null;

        // Toggle list functionality removed

        // Details panel resize functionality
        const aircraftDetails = document.getElementById('aircraftDetails');
        const detailsResizeHandle = document.getElementById('detailsResizeHandle');
        let isResizingDetails = false;

        detailsResizeHandle.addEventListener('mousedown', (e) => {
            if (!aircraftDetails.classList.contains('visible')) return;
            isResizingDetails = true;
            document.body.style.cursor = 'ns-resize';
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizingDetails) return;
            
            const rect = aircraftDetails.getBoundingClientRect();
            const newHeight = e.clientY - rect.top;
            
            const minHeight = 0;
            const entitiesZoneHeight = entitiesZone.getBoundingClientRect().height;
            const maxHeight = entitiesZoneHeight - 100; // Leave space for entity list
            const constrainedHeight = Math.max(minHeight, Math.min(newHeight, maxHeight));
            aircraftDetails.style.height = `${constrainedHeight}px`;
            
            // Hide border when collapsed
            if (constrainedHeight < 5) {
                aircraftDetails.style.borderBottom = 'none';
            } else {
                aircraftDetails.style.borderBottom = '1px solid rgba(57, 65, 80, 0.4)';
            }
            
            e.preventDefault();
        });

        document.addEventListener('mouseup', () => {
            if (isResizingDetails) {
                isResizingDetails = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        // Fullscreen toggle
        let isFullscreen = false;
        const mainContainer = document.querySelector('.main-container');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const expandIcon = document.getElementById('expandIcon');
        const collapseIcon = document.getElementById('collapseIcon');

        // File Menu functionality
        const fileMenuContainer = document.getElementById('fileMenuContainer');
        const fileMenuBtn = document.getElementById('fileMenuBtn');
        const fileMenuDropdown = document.getElementById('fileMenuDropdown');
        const fileOpenBtn = document.getElementById('fileOpenBtn');
        const fileSaveBtn = document.getElementById('fileSaveBtn');
        const fileSaveAsBtn = document.getElementById('fileSaveAsBtn');
        const fileCloseBtn = document.getElementById('fileCloseBtn');

        // Toggle file menu dropdown
        fileMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            fileMenuContainer.classList.toggle('open');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!fileMenuContainer.contains(e.target)) {
                fileMenuContainer.classList.remove('open');
            }
        });

        // File menu actions
        fileOpenBtn.addEventListener('click', () => {
            console.log('Open file clicked');
            fileMenuContainer.classList.remove('open');
            // TODO: Implement file open functionality
        });

        fileSaveBtn.addEventListener('click', () => {
            console.log('Save file clicked');
            fileMenuContainer.classList.remove('open');
            // TODO: Implement file save functionality
        });

        fileSaveAsBtn.addEventListener('click', () => {
            console.log('Save a copy clicked');
            fileMenuContainer.classList.remove('open');
            // TODO: Implement save as functionality
        });

        fileCloseBtn.addEventListener('click', () => {
            fileMenuContainer.classList.remove('open');
            // Close the window/tab
            window.close();
        });

        // Header close button
        const headerCloseBtn = document.getElementById('headerCloseBtn');
        headerCloseBtn.addEventListener('click', () => {
            window.close();
        });

        fullscreenBtn.addEventListener('click', () => {
            isFullscreen = !isFullscreen;
            mainContainer.classList.toggle('fullscreen');
            
            if (isFullscreen) {
                expandIcon.style.display = 'none';
                collapseIcon.style.display = 'block';
            } else {
                expandIcon.style.display = 'block';
                collapseIcon.style.display = 'none';
            }
            
            setTimeout(resizeCanvas, 400);
        });

        // Zoom controls
        let zoomLevel = 60; // Current zoom in NM
        const zoomLevels = [5, 10, 20, 30, 40, 60, 80, 100, 120]; // All available zoom levels
        const presetZoomLevels = [10, 20, 40, 60, 80]; // Visible preset buttons
        let zoomIndex = 5; // Start at 60 NM

        function updateZoomDisplay() {
            document.getElementById('scaleBar').textContent = `${zoomLevel} NM`;
            
            // Update active state on preset buttons
            document.querySelectorAll('.zoom-btn.preset').forEach(btn => {
                const btnZoom = parseInt(btn.dataset.zoom);
                if (btnZoom === zoomLevel) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Zoom in button
        document.getElementById('zoomInBtn').addEventListener('click', () => {
            if (zoomIndex > 0) {
                zoomIndex--;
                zoomLevel = zoomLevels[zoomIndex];
                updateZoomDisplay();
                drawRadar();
            }
        });

        // Zoom out button
        document.getElementById('zoomOutBtn').addEventListener('click', () => {
            if (zoomIndex < zoomLevels.length - 1) {
                zoomIndex++;
                zoomLevel = zoomLevels[zoomIndex];
                updateZoomDisplay();
                drawRadar();
            }
        });

        // Preset zoom buttons
        document.querySelectorAll('.zoom-btn.preset').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetZoom = parseInt(btn.dataset.zoom);
                zoomLevel = targetZoom;
                zoomIndex = zoomLevels.indexOf(targetZoom);
                updateZoomDisplay();
                drawRadar();
            });
        });

        // Center button
        document.getElementById('centerBtn').addEventListener('click', () => {
            // Re-center the view - in a real implementation this would reset pan/offset
            // For now, it just redraws the radar at current zoom
            drawRadar();
        });

        // Category switching
        const categoryBtns = document.querySelectorAll('.category-btn');
        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                categoryBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory = btn.dataset.category;
                currentEntities = entities[currentCategory];
                populateEntityList();
                drawRadar();
            });
        });

        // Expand all / Collapse all functionality
        // Toggle panel functionality
        const togglePanelBtn = document.getElementById('togglePanelBtn');
        const showPanelBtn = document.getElementById('showPanelBtn');
        const panelIndicator = document.getElementById('panelIndicator');
        const zoomControls = document.querySelector('.zoom-controls');
        const entityCollapseHandle = document.getElementById('entityCollapseHandle');

        // Function to toggle entity panel
        function toggleEntityPanel() {
            const isHidden = entitiesZone.classList.contains('hidden');
            
            if (isHidden) {
                // Show panel
                entitiesZone.classList.remove('hidden');
                showPanelBtn.classList.remove('visible');
                panelIndicator.style.opacity = '1';
                // Position zoom controls based on current mode
                if (entitiesZone.classList.contains('profiles-mode')) {
                    zoomControls.style.right = '470px';
                } else {
                    zoomControls.style.right = '340px';
                }
            } else {
                // Hide panel
                entitiesZone.classList.add('hidden');
                showPanelBtn.classList.remove('visible');
                panelIndicator.style.opacity = '0.3';
                zoomControls.style.right = '20px';
            }
            resizeCanvas();
        }

        // Toggle button in header
        togglePanelBtn.addEventListener('click', toggleEntityPanel);

        // Collapse handle on panel edge
        entityCollapseHandle.addEventListener('click', toggleEntityPanel);

        // Original toggle logic (keeping for compatibility)
        if (false) {
        togglePanelBtn.addEventListener('click', () => {
            const isHidden = entitiesZone.classList.contains('hidden');
            
            if (isHidden) {
                // Show panel
                entitiesZone.classList.remove('hidden');
                showPanelBtn.classList.remove('visible');
                panelIndicator.style.opacity = '1';
                // Position zoom controls based on current mode
                if (entitiesZone.classList.contains('profiles-mode')) {
                    zoomControls.style.right = '470px';
                } else {
                    zoomControls.style.right = '340px';
                }
            } else {
                // Hide panel
                entitiesZone.classList.add('hidden');
                showPanelBtn.classList.remove('visible');
                panelIndicator.style.opacity = '0.3';
                zoomControls.style.right = '20px';
            }
            resizeCanvas();
        });
        } // end if (false)

        // Show panel button (on radar) also works
        showPanelBtn.addEventListener('click', () => {
            entitiesZone.classList.remove('hidden');
            showPanelBtn.classList.remove('visible');
            panelIndicator.style.opacity = '1';
            // Position zoom controls based on current mode
            if (entitiesZone.classList.contains('profiles-mode')) {
                zoomControls.style.right = '470px';
            } else {
                zoomControls.style.right = '340px';
            }
            resizeCanvas();
        });

        // Toggle tool pane functionality
        const toggleToolPaneBtn = document.getElementById('toggleToolPaneBtn');
        const toolPane = document.getElementById('toolPane');
        const settingsPane = document.getElementById('settingsPane');
        const toolPaneIndicator = document.getElementById('toolPaneIndicator');
        const panelCollapseHandle = document.getElementById('panelCollapseHandle');

        // Toolbar navigation
        const toolbarDisplayBtn = document.getElementById('toolbarDisplayBtn');
        const toolbarTargetBtn = document.getElementById('toolbarTargetBtn');
        const toolbarViewsBtn = document.getElementById('toolbarViewsBtn');
        const toolbarSettingsBtn = document.getElementById('toolbarSettingsBtn');
        const toolPaneTitle = document.getElementById('toolPaneTitle');
        const toolPaneViews = document.querySelectorAll('.tool-pane-view');

        function switchToolPane(paneName) {
            // Remove active state from toolbar buttons (except settings)
            toolbarDisplayBtn.classList.remove('active');
            toolbarTargetBtn.classList.remove('active');
            toolbarViewsBtn.classList.remove('active');
            
            // Update active pane view
            toolPaneViews.forEach(pane => {
                if (pane.getAttribute('data-pane') === paneName) {
                    pane.classList.add('active');
                } else {
                    pane.classList.remove('active');
                }
            });

            // Update title and active button
            if (paneName === 'display') {
                toolPaneTitle.textContent = 'Display';
                toolbarDisplayBtn.classList.add('active');
            } else if (paneName === 'aircraft') {
                toolPaneTitle.textContent = 'Target';
                toolbarTargetBtn.classList.add('active');
            } else if (paneName === 'views') {
                toolPaneTitle.textContent = 'Inset Window';
                toolbarViewsBtn.classList.add('active');
            }
            
            // Make sure tool pane is visible
            toolPane.style.display = 'flex';
            settingsPane.style.display = 'none';
            toolbarSettingsBtn.classList.remove('active');
        }

        function switchPanel(panelName) {
            // Hide all panels
            toolPane.style.display = 'none';
            settingsPane.style.display = 'none';

            // Remove active state from all buttons
            document.querySelectorAll('.toolbar-icon-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected panel and activate button
            if (panelName === 'settings') {
                settingsPane.style.display = 'flex';
                toolbarSettingsBtn.classList.add('active');
            } else {
                // For display, aircraft, views - show tool pane with correct view
                switchToolPane(panelName);
            }
        }

        // Toolbar button click handlers
        toolbarDisplayBtn.addEventListener('click', () => switchPanel('display'));
        toolbarTargetBtn.addEventListener('click', () => switchPanel('aircraft'));
        toolbarViewsBtn.addEventListener('click', () => switchPanel('views'));
        toolbarSettingsBtn.addEventListener('click', () => switchPanel('settings'));

        // Inset Corner Toggle Functionality - Option C: Click to open mini-config popup
        const insetCorners = document.querySelectorAll('.inset-corner');
        const activeInsetsCount = document.getElementById('activeInsetsCount');
        const insetPopup = document.getElementById('insetPopup');
        const popupTitle = document.getElementById('popupTitle');
        const popupViewSelect = document.getElementById('popupViewSelect');
        const popupRangeInput = document.getElementById('popupRangeInput');
        const popupConfirmBtn = document.getElementById('popupConfirmBtn');
        const popupRemoveBtn = document.getElementById('popupRemoveBtn');
        const popupCancelBtn = document.getElementById('popupCancelBtn');
        const insetScreenTemplate = document.getElementById('insetScreenTemplate');
        
        // Store inset configurations
        const insetConfigs = {};
        let currentEditPosition = null;
        
        function updateInsetsCount() {
            activeInsetsCount.textContent = Object.keys(insetConfigs).length;
        }
        
        function updateCornerVisual(position) {
            const corner = document.querySelector(`[data-position="${position}"]`);
            const label = corner.querySelector('.inset-label');
            const plusIcon = corner.querySelector('.inset-plus-icon');
            
            if (insetConfigs[position]) {
                corner.classList.add('active');
                plusIcon.style.display = 'none';
                label.style.display = 'block';
                const viewName = insetConfigs[position].view.charAt(0).toUpperCase() + insetConfigs[position].view.slice(1);
                label.textContent = viewName + ' ' + insetConfigs[position].range + 'NM';
            } else {
                corner.classList.remove('active');
                plusIcon.style.display = 'block';
                label.style.display = 'none';
            }
        }
        
        function positionPopup(corner, position) {
            const rect = corner.getBoundingClientRect();
            const templateRect = insetScreenTemplate.getBoundingClientRect();
            
            // Position popup near the corner but inside the template
            let left, top;
            
            if (position.includes('left')) {
                left = 70; // Right of left corners
            } else {
                left = templateRect.width - 210; // Left of right corners
            }
            
            if (position.includes('top')) {
                top = 10;
            } else {
                top = templateRect.height - 130;
            }
            
            insetPopup.style.left = left + 'px';
            insetPopup.style.top = top + 'px';
        }
        
        function showPopup(position, isEdit) {
            const corner = document.querySelector(`[data-position="${position}"]`);
            currentEditPosition = position;
            
            if (isEdit && insetConfigs[position]) {
                // Editing existing inset
                popupTitle.textContent = 'Edit Inset';
                popupViewSelect.value = insetConfigs[position].view;
                popupRangeInput.value = insetConfigs[position].range;
                popupConfirmBtn.textContent = 'Update';
                popupRemoveBtn.style.display = 'block';
            } else {
                // Adding new inset
                popupTitle.textContent = 'Add Inset';
                popupViewSelect.value = 'ground';
                popupRangeInput.value = 5;
                popupConfirmBtn.textContent = 'Add';
                popupRemoveBtn.style.display = 'none';
            }
            
            positionPopup(corner, position);
            insetPopup.style.display = 'block';
        }
        
        function hidePopup() {
            insetPopup.style.display = 'none';
            currentEditPosition = null;
        }
        
        // Corner click - open popup
        insetCorners.forEach(corner => {
            corner.addEventListener('click', (e) => {
                e.stopPropagation();
                const position = corner.dataset.position;
                const isEdit = !!insetConfigs[position];
                showPopup(position, isEdit);
            });
        });
        
        // Confirm button
        popupConfirmBtn.addEventListener('click', () => {
            if (currentEditPosition) {
                insetConfigs[currentEditPosition] = {
                    view: popupViewSelect.value,
                    range: parseInt(popupRangeInput.value) || 5
                };
                updateCornerVisual(currentEditPosition);
                updateInsetsCount();
                hidePopup();
            }
        });
        
        // Remove button
        popupRemoveBtn.addEventListener('click', () => {
            if (currentEditPosition && insetConfigs[currentEditPosition]) {
                delete insetConfigs[currentEditPosition];
                updateCornerVisual(currentEditPosition);
                updateInsetsCount();
                hidePopup();
            }
        });
        
        // Cancel button
        popupCancelBtn.addEventListener('click', hidePopup);
        
        // Click outside to close popup
        document.addEventListener('click', (e) => {
            if (!insetPopup.contains(e.target) && !e.target.closest('.inset-corner')) {
                hidePopup();
            }
        });

        // Function to toggle panel
        function toggleToolPane() {
            const mainContainer = document.querySelector('.main-container');
            const isHidden = mainContainer.classList.contains('hide-left-section');
            
            if (isHidden) {
                // Show the toolbar and panel
                mainContainer.classList.remove('hide-left-section');
                switchPanel('display');
                toolPaneIndicator.style.opacity = '1';
            } else {
                // Hide both toolbar and panels
                mainContainer.classList.add('hide-left-section');
                toolPaneIndicator.style.opacity = '0.3';
            }
            resizeCanvas();
        }

        // Toggle button in header
        toggleToolPaneBtn.addEventListener('click', toggleToolPane);

        // Collapse handle on panel edge
        panelCollapseHandle.addEventListener('click', toggleToolPane);


        // Close button functionality

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            drawRadar();
        }

        // Draw SRD (Airspace) view
        function drawSRD() {
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w / 2;
            const centerY = h / 2;

            // Very dark background for radar
            ctx.fillStyle = '#0a0e14';
            ctx.fillRect(0, 0, w, h);

            // Range rings - subtle green
            ctx.strokeStyle = 'rgba(40, 120, 80, 0.3)';
            ctx.lineWidth = 1;
            const rings = 6;
            const maxRadius = Math.min(w, h) * 0.45;
            for (let i = 1; i <= rings; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (maxRadius / rings) * i, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Range labels
            ctx.fillStyle = 'rgba(40, 120, 80, 0.5)';
            ctx.font = '9px monospace';
            for (let i = 1; i <= rings; i++) {
                const radius = (maxRadius / rings) * i;
                const nm = (i * 10).toString() + 'NM';
                ctx.fillText(nm, centerX + radius - 20, centerY - 5);
            }

            // Compass rose lines
            ctx.strokeStyle = 'rgba(40, 120, 80, 0.2)';
            ctx.lineWidth = 1;
            for (let angle = 0; angle < 360; angle += 30) {
                const rad = (angle * Math.PI) / 180;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + Math.sin(rad) * maxRadius,
                    centerY - Math.cos(rad) * maxRadius
                );
                ctx.stroke();
            }

            // Compass labels
            ctx.fillStyle = 'rgba(40, 120, 80, 0.6)';
            ctx.font = 'bold 10px monospace';
            const compassLabels = ['N', '030', '060', 'E', '120', '150', 'S', '210', '240', 'W', '300', '330'];
            compassLabels.forEach((label, i) => {
                const angle = i * 30;
                const rad = (angle * Math.PI) / 180;
                const labelRadius = maxRadius + 15;
                const lx = centerX + Math.sin(rad) * labelRadius;
                const ly = centerY - Math.cos(rad) * labelRadius;
                ctx.fillText(label, lx - (label.length * 3), ly + 3);
            });

            // Airways / Routes - subtle
            ctx.strokeStyle = 'rgba(100, 80, 50, 0.25)';
            ctx.lineWidth = 1;
            ctx.setLineDash([8, 8]);
            
            ctx.beginPath();
            ctx.moveTo(w * 0.1, h * 0.2);
            ctx.lineTo(w * 0.9, h * 0.4);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(w * 0.2, h * 0.8);
            ctx.lineTo(w * 0.7, h * 0.2);
            ctx.stroke();

            ctx.setLineDash([]);

            // Waypoints
            ctx.fillStyle = 'rgba(80, 180, 220, 0.7)';
            ctx.font = '9px monospace';
            const waypoints = [
                { x: 0.3, y: 0.3, name: 'ALPHA' },
                { x: 0.7, y: 0.3, name: 'BRAVO' },
                { x: 0.5, y: 0.6, name: 'CHARLY' },
                { x: 0.3, y: 0.8, name: 'DELTA' }
            ];
            waypoints.forEach(wp => {
                const wx = w * wp.x;
                const wy = h * wp.y;
                // Small triangle for waypoint
                ctx.beginPath();
                ctx.moveTo(wx, wy - 4);
                ctx.lineTo(wx - 3, wy + 2);
                ctx.lineTo(wx + 3, wy + 2);
                ctx.closePath();
                ctx.fill();
                ctx.fillText(wp.name, wx + 6, wy + 3);
            });

            // Draw aircraft with radar track symbols
            if (currentCategory === 'aircraft') {
                drawAircraft();
            } else {
                // Draw aircraft from the aircraft array when viewing other categories
                entities.aircraft.forEach((aircraft, idx) => {
                    // Skip inactive aircraft
                    if (aircraft.inactive) return;
                    drawRadarTrack(aircraft, idx, false);
                });
            }
            
            // Draw vectors
            drawVectors();
        }

        // Draw realistic radar track symbol
        function drawRadarTrack(entity, idx, isCurrentCategory) {
            const w = canvas.width;
            const h = canvas.height;
            const x = w * entity.x;
            const y = h * entity.y;
            const isSelected = isCurrentCategory && selectedEntity === idx;
            const isAirborne = entity.level !== '000' && entity.level !== 'GND';
            
            // Track color
            const trackColor = isSelected ? '#60a5fa' : (isAirborne ? '#00ff88' : '#00aaff');
            
            // History dots (past positions)
            const hdg = parseFloat(entity.heading) || 0;
            const hdgRad = ((hdg + 180) * Math.PI) / 180;
            ctx.fillStyle = trackColor;
            for (let i = 1; i <= 4; i++) {
                const histX = x + Math.sin(hdgRad) * (i * 8);
                const histY = y - Math.cos(hdgRad) * (i * 8);
                const dotSize = 2 - (i * 0.3);
                ctx.globalAlpha = 0.8 - (i * 0.15);
                ctx.beginPath();
                ctx.arc(histX, histY, dotSize, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
            
            // Main target symbol - empty circle
            ctx.strokeStyle = trackColor;
            ctx.lineWidth = isSelected ? 2 : 1.5;
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.stroke();
            
            // Velocity vector (line showing heading)
            const vecLength = 25;
            const vecRad = (hdg * Math.PI) / 180;
            const vecEndX = x + Math.sin(vecRad) * vecLength;
            const vecEndY = y - Math.cos(vecRad) * vecLength;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(vecEndX, vecEndY);
            ctx.stroke();
            
            // Leader line to data block
            const leaderLength = 30;
            const leaderAngle = 45; // degrees
            const leaderRad = (leaderAngle * Math.PI) / 180;
            const leaderEndX = x + Math.cos(leaderRad) * leaderLength;
            const leaderEndY = y - Math.sin(leaderRad) * leaderLength;
            
            ctx.strokeStyle = isSelected ? 'rgba(96, 165, 250, 0.6)' : 'rgba(150, 150, 150, 0.4)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x + 6, y - 4);
            ctx.lineTo(leaderEndX, leaderEndY);
            ctx.stroke();
            
            // Data block background
            const blockX = leaderEndX + 2;
            const blockY = leaderEndY - 24;
            const blockW = 70;
            const blockH = 28;
            
            ctx.fillStyle = isSelected ? 'rgba(30, 40, 60, 0.9)' : 'rgba(10, 15, 20, 0.8)';
            ctx.fillRect(blockX, blockY, blockW, blockH);
            
            if (isSelected) {
                ctx.strokeStyle = 'rgba(96, 165, 250, 0.5)';
                ctx.lineWidth = 1;
                ctx.strokeRect(blockX, blockY, blockW, blockH);
            }
            
            // Data block text
            ctx.fillStyle = isSelected ? '#60a5fa' : trackColor;
            ctx.font = 'bold 10px monospace';
            ctx.fillText(entity.callsign, blockX + 3, blockY + 11);
            
            ctx.fillStyle = isSelected ? '#ffffff' : 'rgba(200, 200, 200, 0.9)';
            ctx.font = '9px monospace';
            const altText = isAirborne ? entity.level : 'GND';
            const dataLine = `${altText} ${entity.speed}`;
            ctx.fillText(dataLine, blockX + 3, blockY + 22);
        }

        // Draw aircraft for airspace view
        function drawAircraft() {
            currentEntities.forEach((entity, idx) => {
                // Skip inactive aircraft
                if (entity.inactive) return;
                drawRadarTrack(entity, idx, true);
            });
        }

        // Draw SMD (Surface Movement) view
        function drawSMD() {
            const w = canvas.width;
            const h = canvas.height;

            // Very dark background
            ctx.fillStyle = '#0a0e14';
            ctx.fillRect(0, 0, w, h);

            // Runways - darker asphalt
            ctx.fillStyle = 'rgba(40, 45, 50, 0.95)';
            
            // Runway 09/27
            const rw1Width = w * 0.6;
            const rw1Height = h * 0.08;
            const rw1X = (w - rw1Width) / 2;
            const rw1Y = h * 0.45;
            ctx.fillRect(rw1X, rw1Y, rw1Width, rw1Height);

            // Runway edge lights
            ctx.fillStyle = 'rgba(255, 255, 200, 0.6)';
            for (let i = 0; i < 30; i++) {
                const x = rw1X + (rw1Width / 30) * i;
                ctx.fillRect(x, rw1Y - 2, 2, 2);
                ctx.fillRect(x, rw1Y + rw1Height, 2, 2);
            }

            // Runway centerline
            ctx.strokeStyle = 'rgba(220, 220, 220, 0.8)';
            ctx.lineWidth = 2;
            ctx.setLineDash([15, 15]);
            ctx.beginPath();
            ctx.moveTo(rw1X, rw1Y + rw1Height / 2);
            ctx.lineTo(rw1X + rw1Width, rw1Y + rw1Height / 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Runway numbers
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.font = 'bold 18px monospace';
            ctx.fillText('09', rw1X + 20, rw1Y + rw1Height / 2 + 6);
            ctx.fillText('27', rw1X + rw1Width - 50, rw1Y + rw1Height / 2 + 6);

            // Taxiways - darker
            ctx.strokeStyle = 'rgba(60, 70, 80, 0.7)';
            ctx.lineWidth = w * 0.03;
            ctx.lineCap = 'round';

            // Taxiway A (parallel to runway)
            ctx.beginPath();
            ctx.moveTo(w * 0.2, rw1Y + rw1Height + 60);
            ctx.lineTo(w * 0.8, rw1Y + rw1Height + 60);
            ctx.stroke();

            // Taxiway edge lights
            ctx.fillStyle = 'rgba(100, 150, 255, 0.5)';
            for (let i = 0; i < 20; i++) {
                const x = w * 0.2 + ((w * 0.6) / 20) * i;
                const y = rw1Y + rw1Height + 60;
                ctx.fillRect(x, y - 12, 2, 2);
                ctx.fillRect(x, y + 12, 2, 2);
            }

            // Taxiway B (perpendicular connectors)
            ctx.strokeStyle = 'rgba(60, 70, 80, 0.7)';
            ctx.beginPath();
            ctx.moveTo(w * 0.35, rw1Y + rw1Height);
            ctx.lineTo(w * 0.35, rw1Y + rw1Height + 60);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(w * 0.65, rw1Y + rw1Height);
            ctx.lineTo(w * 0.65, rw1Y + rw1Height + 60);
            ctx.stroke();

            // Taxiway signs
            ctx.fillStyle = 'rgba(255, 200, 50, 0.8)';
            ctx.font = 'bold 11px monospace';
            ctx.fillText('A', w * 0.25, rw1Y + rw1Height + 50);
            ctx.fillText('B', w * 0.35 - 5, rw1Y + rw1Height + 30);

            // Terminal / Apron - darker
            ctx.fillStyle = 'rgba(50, 60, 70, 0.9)';
            ctx.fillRect(w * 0.3, h * 0.7, w * 0.4, h * 0.15);
            
            // Terminal windows
            ctx.fillStyle = 'rgba(255, 220, 150, 0.4)';
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 3; j++) {
                    ctx.fillRect(
                        w * 0.32 + i * (w * 0.045),
                        h * 0.72 + j * 15,
                        w * 0.03,
                        10
                    );
                }
            }

            // Terminal label
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 13px monospace';
            ctx.fillText('TERMINAL', w * 0.43, h * 0.79);

            // Parking spots with markings
            ctx.strokeStyle = 'rgba(255, 255, 100, 0.6)';
            ctx.lineWidth = 1.5;
            for (let i = 0; i < 6; i++) {
                const x = w * 0.32 + i * (w * 0.06);
                const y = h * 0.72;
                ctx.strokeRect(x, y, w * 0.04, h * 0.06);
                // Parking number
                ctx.fillStyle = 'rgba(255, 255, 100, 0.7)';
                ctx.font = '10px monospace';
                ctx.fillText((i + 1).toString(), x + w * 0.015, y - 5);
            }

            // Draw all entities on SMD
            drawAllEntitiesSurface();
            
            // Draw vectors
            drawVectors();
        }

        // Draw ground entities (vehicles, objects)
        function drawGroundEntities() {
            const w = canvas.width;
            const h = canvas.height;

            currentEntities.forEach((entity, idx) => {
                const x = w * entity.x;
                const y = h * entity.y;
                const isSelected = selectedEntity === idx;

                ctx.save();

                // Glow effect for selected
                if (isSelected) {
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = '#3b82f6';
                }

                // Different shapes based on category
                if (currentCategory === 'vehicles') {
                    // Vehicle (rectangle)
                    ctx.translate(x, y);
                    ctx.rotate((entity.heading * Math.PI) / 180);
                    ctx.fillStyle = '#fbbf24';
                    ctx.fillRect(-8, -5, 16, 10);
                } else if (currentCategory === 'objects') {
                    // Objects (circle)
                    ctx.fillStyle = '#ef4444';
                    ctx.beginPath();
                    ctx.arc(x, y, 6, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.restore();

                // Label
                ctx.shadowBlur = 0;
                ctx.fillStyle = isSelected ? '#3b82f6' : 'rgba(255, 255, 255, 0.9)';
                ctx.font = isSelected ? 'bold 10px monospace' : '10px monospace';
                ctx.fillText(entity.callsign, x + 12, y);
            });
        }

        // Draw all entities on surface (SMD view)
        function drawAllEntitiesSurface() {
            const w = canvas.width;
            const h = canvas.height;

            // Draw aircraft
            entities.aircraft.forEach((entity, idx) => {
                const x = w * entity.x;
                const y = h * entity.y;
                const isSelected = selectedEntity === idx && currentCategory === 'aircraft';

                ctx.save();
                if (isSelected) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#3b82f6';
                }

                ctx.translate(x, y);
                const hdg = parseFloat(entity.heading) || 0;
                ctx.rotate((hdg * Math.PI) / 180);

                // Aircraft shape
                ctx.fillStyle = '#3b82f6';
                ctx.beginPath();
                ctx.moveTo(0, -10);
                ctx.lineTo(-6, 8);
                ctx.lineTo(-3, 8);
                ctx.lineTo(-3, 11);
                ctx.lineTo(3, 11);
                ctx.lineTo(3, 8);
                ctx.lineTo(6, 8);
                ctx.closePath();
                ctx.fill();

                ctx.restore();

                ctx.shadowBlur = 0;
                ctx.fillStyle = isSelected ? '#3b82f6' : 'rgba(255, 255, 255, 0.85)';
                ctx.font = isSelected ? 'bold 10px monospace' : '10px monospace';
                ctx.fillText(entity.callsign, x + 12, y - 2);
            });

            // Draw vehicles
            entities.vehicles.forEach((entity, idx) => {
                const x = w * entity.x;
                const y = h * entity.y;
                const isSelected = selectedEntity === idx && currentCategory === 'vehicles';

                ctx.save();
                if (isSelected) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#3b82f6';
                }

                ctx.translate(x, y);
                const hdg = parseFloat(entity.heading) || 0;
                ctx.rotate((hdg * Math.PI) / 180);
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(-8, -5, 16, 10);

                ctx.restore();

                ctx.shadowBlur = 0;
                ctx.fillStyle = isSelected ? '#3b82f6' : 'rgba(255, 200, 80, 0.9)';
                ctx.font = isSelected ? 'bold 10px monospace' : '10px monospace';
                ctx.fillText(entity.callsign, x + 12, y);
            });

            // Draw objects
            entities.objects.forEach((entity, idx) => {
                const x = w * entity.x;
                const y = h * entity.y;
                const isSelected = selectedEntity === idx && currentCategory === 'objects';

                ctx.save();
                if (isSelected) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#3b82f6';
                }

                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();

                ctx.shadowBlur = 0;
                ctx.fillStyle = isSelected ? '#3b82f6' : 'rgba(255, 100, 100, 0.9)';
                ctx.font = isSelected ? 'bold 9px monospace' : '9px monospace';
                ctx.fillText(entity.callsign, x + 10, y);
            });
        }

        // Draw vectors on radar
        function drawVectors() {
            const w = canvas.width;
            const h = canvas.height;
            
            // vector1 - subtle cyan line from bottom-left to top-right
            ctx.strokeStyle = 'rgba(100, 180, 220, 0.5)';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(w * 0.25, h * 0.75);
            ctx.lineTo(w * 0.75, h * 0.25);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // vector1 label
            ctx.fillStyle = 'rgba(100, 180, 220, 0.7)';
            ctx.font = '10px monospace';
            ctx.fillText('vector1', w * 0.26, h * 0.73);
            
            // vector2 - subtle cyan line from left-center to right-center
            ctx.strokeStyle = 'rgba(100, 180, 220, 0.5)';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(w * 0.3, h * 0.5);
            ctx.lineTo(w * 0.7, h * 0.5);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // vector2 label
            ctx.fillStyle = 'rgba(100, 180, 220, 0.7)';
            ctx.font = '10px monospace';
            ctx.fillText('vector2', w * 0.31, h * 0.48);
        }

        function drawRadar() {
            if (currentView === 'SRD') {
                drawSRD();
            } else {
                drawSMD();
            }
        }

        // View switching
        const btnSMD = document.getElementById('btnSMD');
        const btnSRD = document.getElementById('btnSRD');
        const scaleBar = document.getElementById('scaleBar');
        const radarInfo = document.getElementById('radarInfo');

        btnSMD.addEventListener('click', () => {
            currentView = 'SMD';
            btnSMD.classList.add('active');
            btnSRD.classList.remove('active');
            scaleBar.textContent = '2 NM';
            radarInfo.textContent = 'SURFACE MOVEMENT';
            drawRadar();
        });

        btnSRD.addEventListener('click', () => {
            currentView = 'SRD';
            btnSRD.classList.add('active');
            btnSMD.classList.remove('active');
            scaleBar.textContent = '4 NM';
            radarInfo.textContent = 'AIRSPACE VIEW';
            drawRadar();
        });

        // Canvas click to select entity
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;

            let entityClicked = false;
            currentEntities.forEach((entity, idx) => {
                const x = canvas.width * entity.x;
                const y = canvas.height * entity.y;
                const distance = Math.sqrt((clickX - x) ** 2 + (clickY - y) ** 2);

                if (distance < 20) {
                    entityClicked = true;
                    selectedEntity = idx;
                    // Select in table
                    document.querySelectorAll('.table-row').forEach((row, i) => {
                        if (i === idx) {
                            row.classList.add('selected');
                        } else {
                            row.classList.remove('selected');
                        }
                    });
                    // Show aircraft details, hide scenario info
                    document.getElementById('scenarioInfo').classList.remove('visible');
                    document.getElementById('aircraftDetails').classList.add('visible');
                    updateAircraftDetails(entity);
                    drawRadar();
                }
            });

            // If clicked on background, unselect and show scenario info
            if (!entityClicked) {
                selectedEntity = null;
                document.querySelectorAll('.table-row').forEach(row => row.classList.remove('selected'));
                // Show scenario info, hide aircraft details
                document.getElementById('aircraftDetails').classList.remove('visible');
                document.getElementById('scenarioInfo').classList.add('visible');
                drawRadar();
            }
        });

        // Populate entity list
        function populateEntityList() {
            const entityList = document.getElementById('entityList');
            entityList.innerHTML = '';
            
            currentEntities.forEach((entity, index) => {
                const row = document.createElement('div');
                row.className = 'table-row' + (index % 2 === 1 ? ' row-even' : '') + (entity.inactive ? ' inactive' : '');
                row.dataset.index = index;
                
                row.innerHTML = `
                    <div class="table-row-left">
                        <div class="callsign-cell">${entity.callsign}</div>
                        <div class="table-row-data">
                            <div>${entity.type}</div>
                            <div class="${entity.level !== '000' && entity.level !== 'GND' && entity.level !== '---' ? 'altitude-indicator' : ''}">${entity.level}</div>
                            <div>${entity.heading}</div>
                            <div class="${entity.level !== '000' && entity.level !== 'GND' && entity.level !== '---' ? 'altitude-indicator' : ''}">${entity.speed}</div>
                        </div>
                        <div class="row-expand-btn" data-index="${index}"></div>
                    </div>
                    <div class="table-row-profile">
                        <div class="profile-canvas-container">
                            <canvas class="inline-profile-canvas" id="inline-chart-${index}" width="600" height="28"></canvas>
                        </div>
                    </div>
                `;
                
                // Row click handler (for selection)
                row.addEventListener('click', (e) => {
                    // Toggle selection if clicking same row
                    if (row.classList.contains('selected')) {
                        row.classList.remove('selected');
                        selectedEntity = null;
                        // Show scenario info, hide aircraft details
                        document.getElementById('aircraftDetails').classList.remove('visible');
                        document.getElementById('scenarioInfo').classList.add('visible');
                    } else {
                        document.querySelectorAll('.table-row').forEach(r => r.classList.remove('selected'));
                        row.classList.add('selected');
                        selectedEntity = index;
                        // Show aircraft details, hide scenario info
                        document.getElementById('scenarioInfo').classList.remove('visible');
                        document.getElementById('aircraftDetails').classList.add('visible');
                        updateAircraftDetails(entity);
                    }
                    drawRadar();
                });
                
                entityList.appendChild(row);
            });
            
            // Draw all inline profiles if in profiles mode
            if (entitiesZone.classList.contains('profiles-mode')) {
                currentEntities.forEach((entity, index) => {
                    const canvas = document.getElementById(`inline-chart-${index}`);
                    if (canvas) {
                        drawInlineProfile(canvas, entity);
                    }
                });
            }
        }

        // Toggle Profiles button handler
        const toggleProfilesBtn = document.getElementById('toggleProfilesBtn');
        const entitiesZone = document.getElementById('entitiesZone');

        toggleProfilesBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            
            const isProfilesMode = entitiesZone.classList.contains('profiles-mode');
            
            if (isProfilesMode) {
                // Switch to data mode (Type, Level, HDG, Kts)
                entitiesZone.classList.remove('profiles-mode');
                toggleProfilesBtn.classList.remove('active');
                if (!entitiesZone.classList.contains('hidden')) {
                    zoomControls.style.right = '340px';
                }
            } else {
                // Switch to profiles mode
                entitiesZone.classList.add('profiles-mode');
                toggleProfilesBtn.classList.add('active');
                if (!entitiesZone.classList.contains('hidden')) {
                    zoomControls.style.right = '470px';
                }
                
                // Draw all inline profiles
                currentEntities.forEach((entity, index) => {
                    const canvas = document.getElementById(`inline-chart-${index}`);
                    if (canvas) {
                        drawInlineProfile(canvas, entity);
                    }
                });
            }
            
            resizeCanvas();
        });

        function drawInlineProfile(canvas, entity) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Generate varied random profile based on callsign seed
            const seed = entity.callsign.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const points = 50;
            const data = [];
            
            // Determine profile type based on seed
            const profileType = seed % 8;
            const maxAlt = 20000 + (seed % 20000); // Varied max altitudes
            
            for (let i = 0; i < points; i++) {
                const progress = i / (points - 1);
                let alt = 0;
                
                switch(profileType) {
                    case 0: // Steady climb to cruise
                        if (progress < 0.3) {
                            alt = maxAlt * (progress / 0.3);
                        } else {
                            alt = maxAlt * (0.95 + Math.sin(progress * 12) * 0.05);
                        }
                        break;
                        
                    case 1: // Cruise then descend
                        if (progress < 0.6) {
                            alt = maxAlt * (0.95 + Math.sin(progress * 8) * 0.05);
                        } else {
                            alt = maxAlt * (1 - ((progress - 0.6) / 0.4) * 0.9);
                        }
                        break;
                        
                    case 2: // Step climbs
                        if (progress < 0.25) {
                            alt = maxAlt * 0.6;
                        } else if (progress < 0.5) {
                            alt = maxAlt * 0.8;
                        } else {
                            alt = maxAlt;
                        }
                        alt += Math.sin(progress * 20) * 500;
                        break;
                        
                    case 3: // Full flight profile
                        if (progress < 0.2) {
                            alt = maxAlt * (progress / 0.2) * 0.9;
                        } else if (progress < 0.7) {
                            alt = maxAlt * 0.95;
                        } else {
                            alt = maxAlt * 0.9 * (1 - ((progress - 0.7) / 0.3));
                        }
                        break;
                        
                    case 4: // Gradual descent from high altitude
                        alt = maxAlt * (1 - progress * 0.8) + Math.sin(progress * 15) * 1000;
                        break;
                        
                    case 5: // Low altitude flight
                        alt = (maxAlt * 0.3) + Math.sin(progress * 10) * 1500;
                        break;
                        
                    case 6: // Climbing flight
                        alt = maxAlt * progress * 0.85 + Math.sin(progress * 8) * 800;
                        break;
                        
                    case 7: // Varied altitude cruise
                        alt = maxAlt * 0.7 + Math.sin(progress * 18) * (maxAlt * 0.25);
                        break;
                }
                
                data.push(Math.max(0, alt));
            }
            
            const maxDataAlt = Math.max(...data);
            const minDataAlt = Math.min(...data);
            const altRange = maxDataAlt - minDataAlt || 1000;
            
            // Draw grid lines for reference
            ctx.strokeStyle = 'rgba(57, 65, 80, 0.2)';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= 3; i++) {
                const y = (height / 3) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Create gradient from green (low altitude) to blue (high altitude)
            const gradient = ctx.createLinearGradient(0, height, 0, 0);
            gradient.addColorStop(0, '#6ee7b7');     // Light green at bottom (ground level)
            gradient.addColorStop(0.25, '#34d399');  // Medium green
            gradient.addColorStop(0.5, '#10b981');   // Darker green
            gradient.addColorStop(0.7, '#3b82f6');   // Medium blue (cruise altitude)
            gradient.addColorStop(1, '#1e40af');     // Dark blue at top (high altitude)
            
            // Draw profile line with gradient
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((data[i] - minDataAlt) / altRange) * (height - 4) - 2;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Fill under curve with semi-transparent gradient
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            
            const fillGradient = ctx.createLinearGradient(0, height, 0, 0);
            fillGradient.addColorStop(0, 'rgba(110, 231, 183, 0.15)');   // Light green at bottom
            fillGradient.addColorStop(0.5, 'rgba(16, 185, 129, 0.1)');   // Medium green
            fillGradient.addColorStop(1, 'rgba(59, 130, 246, 0.15)');    // Blue at top
            
            ctx.fillStyle = fillGradient;
            ctx.fill();
        }

        function updateAircraftDetails(entity) {
            const detailsPanel = document.getElementById('aircraftDetails');
            
            if (currentCategory === 'aircraft') {
                detailsPanel.classList.add('visible');
                
                // Update callsign and type in header
                document.getElementById('detailCallsign').textContent = entity.callsign;
                document.getElementById('detailTypeCode').textContent = entity.type;
                document.getElementById('detailTypeName').textContent = getAircraftTypeName(entity.type);
                
                // Status badge
                const statusBadge = document.getElementById('detailStatusBadge');
                const isAirborne = entity.level !== '000' && entity.level !== 'GND';
                statusBadge.textContent = isAirborne ? 'Airborne' : 'Ground';
                statusBadge.className = 'details-status-badge ' + (isAirborne ? 'airborne' : 'ground');
                
                // Toggle airborne/grounded class for showing/hiding sections
                if (isAirborne) {
                    detailsPanel.classList.add('airborne');
                    detailsPanel.classList.remove('grounded');
                } else {
                    detailsPanel.classList.add('grounded');
                    detailsPanel.classList.remove('airborne');
                }
                
                const seed = entity.callsign.charCodeAt(0) + entity.callsign.charCodeAt(1);
                
                // Basic Info Section
                document.getElementById('detailTypeData').textContent = entity.type;
                const squawkBase = isAirborne ? 2000 + (seed % 5000) : 1200;
                document.getElementById('detailSSR').textContent = squawkBase.toString().padStart(4, '0');
                
                // Flight Data Section
                document.getElementById('detailHeading').innerHTML = entity.heading.toString().padStart(3, '0') + '<span class="data-cell-unit"></span>';
                
                const turnRate = ((seed % 7) * 0.5).toFixed(1);
                document.getElementById('detailTurnRate').innerHTML = turnRate + '<span class="data-cell-unit">/s</span>';
                
                // Vertical speed (climb/descend rate in ft/s)
                const verticalSpeed = isAirborne ? (((seed % 20) - 10) * 10) : 0; // -100 to +100 ft/s range
                const vsSign = verticalSpeed > 0 ? '+' : '';
                document.getElementById('detailVerticalSpeed').innerHTML = vsSign + verticalSpeed + '<span class="data-cell-unit">ft/s</span>';
                
                const altitudeEl = document.getElementById('detailAltitude');
                if (isAirborne) {
                    const altFt = parseInt(entity.level) * 100;
                    altitudeEl.innerHTML = altFt.toLocaleString() + '<span class="data-cell-unit">ft</span>';
                    altitudeEl.classList.add('highlight');
                } else {
                    altitudeEl.innerHTML = '0<span class="data-cell-unit">ft</span>';
                    altitudeEl.classList.remove('highlight');
                }
                
                document.getElementById('detailSpeed').innerHTML = entity.speed + '<span class="data-cell-unit">kts</span>';
                
                // Status Section
                const statusTexts = ['Climb', 'Cruise', 'Descend', 'Level', 'Hold'];
                const statusIdx = seed % statusTexts.length;
                document.getElementById('detailStatus').textContent = isAirborne ? statusTexts[statusIdx] : 'Ground';
                
                const actionTexts = ['Direct', 'Vector', 'Apprch', 'Depart', 'Clrd'];
                const actionIdx = (seed + 2) % actionTexts.length;
                document.getElementById('detailAction').textContent = isAirborne ? actionTexts[actionIdx] : 'Taxi';
                
                // Route Info Section
                document.getElementById('detailIntentions').textContent = isAirborne ? 'LAND' : '---';
                
                const airways = ['J42', 'V23', 'Q12', 'A1', 'B456'];
                const airwayIdx = seed % airways.length;
                document.getElementById('detailAirRoute').textContent = isAirborne ? airways[airwayIdx] : '---';
                
                const depRoutes = ['RNAV1', 'RADAR', 'BOTON2', 'CLARE1'];
                const depIdx = (seed + 3) % depRoutes.length;
                document.getElementById('detailDepartureRoute').textContent = depRoutes[depIdx];
                if (document.getElementById('detailDepartureRouteAirborne')) {
                    document.getElementById('detailDepartureRouteAirborne').textContent = depRoutes[depIdx];
                }
                
                const arrRoutes = ['STAR1', 'STAR2', 'VECTOR', 'ILS28'];
                const arrIdx = (seed + 4) % arrRoutes.length;
                document.getElementById('detailArrivalRoute').textContent = arrRoutes[arrIdx];
                
                // Parking (ground only)
                const parkings = ['A1', 'A2', 'B12', 'C5', 'T1', 'T2', 'G3', 'G7'];
                const parkingIdx = (seed + 5) % parkings.length;
                document.getElementById('detailParking').textContent = isAirborne ? '---' : parkings[parkingIdx];
                
                // Runway
                const runways = ['27L', '09R', '18', '36', '28R', '10L'];
                const rwyIdx = seed % runways.length;
                document.getElementById('detailRwyPad').textContent = runways[rwyIdx];
                if (document.getElementById('detailRwyPadAirborne')) {
                    document.getElementById('detailRwyPadAirborne').textContent = runways[rwyIdx];
                }
                
                // Navigation Section
                const fixes = ['WAVEY', 'BALDI', 'HOMER', 'FIXUP', 'RADIX'];
                const fixIdx = seed % fixes.length;
                document.getElementById('detailFix').textContent = isAirborne ? fixes[fixIdx] : '---';
                
                const refs = ['VOR', 'NDB', 'DME', 'GPS'];
                const refIdx = (seed + 1) % refs.length;
                document.getElementById('detailRef').textContent = isAirborne ? refs[refIdx] : '---';
                
                const radial = isAirborne ? (seed * 7) % 360 : 0;
                document.getElementById('detailRad').innerHTML = radial.toString().padStart(3, '0') + '<span class="data-cell-unit"></span>';
                
                const dist = isAirborne ? 5 + (seed % 50) : '--';
                document.getElementById('detailDist').innerHTML = dist + '<span class="data-cell-unit">nm</span>';
                
            } else {
                detailsPanel.classList.remove('visible');
            }
        }

        function getAircraftTypeName(typeCode) {
            const typeNames = {
                'B757': 'Boeing 757',
                'C172': 'Cessna 172',
                'B747': 'Boeing 747',
                'F16': 'F-16 Fighting Falcon',
                'C182': 'Cessna 182',
                'T38': 'T-38 Talon',
                'B737': 'Boeing 737',
                'A320': 'Airbus A320',
                'B738': 'Boeing 737-800',
                'A321': 'Airbus A321',
                'B767': 'Boeing 767',
                'A319': 'Airbus A319',
                'B777': 'Boeing 777',
                'B739': 'Boeing 737-900',
                'A333': 'Airbus A330-300',
                'B789': 'Boeing 787-9',
                'B788': 'Boeing 787-8'
            };
            return typeNames[typeCode] || typeCode;
        }

        // Playback controls
        let isPlaying = false;
        let currentTime = 17; // seconds
        const duration = 60 * 60; // 60:00 in seconds
        let playbackSpeed = 1;

        const btnPlay = document.getElementById('btnPlay');
        const btnPrev = document.getElementById('btnPrev');
        const btnNext = document.getElementById('btnNext');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const currentTimeDisplay = document.getElementById('currentTime');
        const timelineProgress = document.getElementById('timelineProgress');
        const timelineSlider = document.getElementById('timelineSlider');

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            currentTimeDisplay.textContent = formatTime(currentTime);
            const progress = (currentTime / duration) * 100;
            timelineProgress.style.width = `${progress}%`;
        }

        // Toggle play/pause with icon switching
        function togglePlay() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                // Switch to pause icon
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                // Switch to play icon
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
            // Note: Actual playback is disabled - entities remain static
        }

        btnPlay.addEventListener('click', togglePlay);
        
        btnPrev.addEventListener('click', () => {
            currentTime = Math.max(0, currentTime - 10);
            updateTimeDisplay();
        });

        btnNext.addEventListener('click', () => {
            currentTime = Math.min(duration, currentTime + 10);
            updateTimeDisplay();
        });

        // Timeline slider interaction with drag support
        let isDraggingTimeline = false;
        
        function updateTimeFromMouse(e) {
            const rect = timelineSlider.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            currentTime = percent * duration;
            updateTimeDisplay();
        }
        
        timelineSlider.addEventListener('mousedown', (e) => {
            isDraggingTimeline = true;
            updateTimeFromMouse(e);
            document.body.style.userSelect = 'none';
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDraggingTimeline) {
                updateTimeFromMouse(e);
            }
        });
        
        document.addEventListener('mouseup', () => {
            if (isDraggingTimeline) {
                isDraggingTimeline = false;
                document.body.style.userSelect = '';
            }
        });
        
        timelineSlider.addEventListener('click', (e) => {
            if (!isDraggingTimeline) {
                updateTimeFromMouse(e);
            }
        });

        // Speed control (visual only)
        const speedSelector = document.getElementById('speedSelector');
        const speedCurrent = document.getElementById('speedCurrent');
        const speedMenu = document.getElementById('speedMenu');
        
        speedCurrent.addEventListener('click', (e) => {
            e.stopPropagation();
            speedSelector.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            speedSelector.classList.remove('open');
        });

        speedMenu.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        document.querySelectorAll('.speed-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.speed-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                playbackSpeed = parseFloat(option.dataset.speed);
                speedCurrent.textContent = option.textContent;
                speedSelector.classList.remove('open');
            });
        });

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        populateEntityList();
        resizeCanvas();
        updateTimeDisplay();
        updateZoomDisplay();
        
        // Initialize panel indicators based on their state
        if (toolPane.classList.contains('hidden')) {
            toolPaneIndicator.style.opacity = '0.3';
        } else {
            toolPaneIndicator.style.opacity = '1';
        }
        if (entitiesZone.classList.contains('hidden')) {
            panelIndicator.style.opacity = '0.3';
        } else {
            panelIndicator.style.opacity = '1';
        }
    </script>
</body>
</html>
